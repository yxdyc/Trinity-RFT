
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Align configuration with veRL &#8212; Trinity-RFT 0.4.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=183391d5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial/align_with_verl';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quick Start" href="example_reasoning_basic.html" />
    <link rel="prev" title="Synchronizer in Trinity-RFT" href="synchronizer.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="Trinity-RFT 0.4.0 documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.svg" class="logo__image only-dark" alt="Trinity-RFT 0.4.0 documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">
<nav class="bd-links bd-docs-nav">
    <div class="bd-toc-item navbar-nav">
        <ul class="nav bd-sidenav">
      <li class="toctree-l1 has-children">
        <details>
          <summary>
            <p class="caption" aria-level="2" role="heading" style="text-align: center;">
              <span class="fa fa-book"></span>
             <b>latest</b>
            </p>
          </summary>
          <ul>
            <li class="toctree-l2 current "><a class="reference" href="align_with_verl.html">latest</a></li>
          </ul>
        </details>
      </li>
    </ul>
    </div>
</nav>
</div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Guidelines</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="trinity_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop_overview.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop_workflow.html">Workflow Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop_algorithm.html">Algorithms Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_mix_algo.html">Advanced Algorithm Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop_operator.html">Operator Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop_selector.html">üß™ Experimental: Task Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="trinity_configs.html">Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="trinity_gpu_configs.html">GPU Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="synchronizer.html">Synchronizer in Trinity-RFT</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Align configuration with veRL</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="example_reasoning_basic.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_reasoning_advanced.html">Off-Policy RFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_async_mode.html">Asynchronous RFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_multi_turn.html">Concatenated Multi-Turn RFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_step_wise.html">General Multi-Step RFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_react.html">ReAct Agent Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_search_email.html">Email Search Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_dpo.html">Offline DPO and SFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_tinker_backend.html">Tinker Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_megatron.html">Megatron-LM Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_data_functionalities.html">Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_dataset_perspective.html">Example Summary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../api_reference.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.buffer.html">trinity.buffer package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.operators.html">trinity.buffer.operators package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.operators.filters.html">trinity.buffer.operators.filters package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.operators.mappers.html">trinity.buffer.operators.mappers package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.operators.data_juicer_operator.html">trinity.buffer.operators.data_juicer_operator module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.operators.experience_operator.html">trinity.buffer.operators.experience_operator module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.pipelines.html">trinity.buffer.pipelines package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.pipelines.experience_pipeline.html">trinity.buffer.pipelines.experience_pipeline module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.pipelines.task_pipeline.html">trinity.buffer.pipelines.task_pipeline module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.reader.html">trinity.buffer.reader package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.reader.file_reader.html">trinity.buffer.reader.file_reader module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.reader.queue_reader.html">trinity.buffer.reader.queue_reader module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.reader.sql_reader.html">trinity.buffer.reader.sql_reader module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.schema.html">trinity.buffer.schema package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.schema.formatter.html">trinity.buffer.schema.formatter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.schema.sql_schema.html">trinity.buffer.schema.sql_schema module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.selector.html">trinity.buffer.selector package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.selector.difficulty_estimator.html">trinity.buffer.selector.difficulty_estimator module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.selector.selector.html">trinity.buffer.selector.selector module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.storage.html">trinity.buffer.storage package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.storage.file.html">trinity.buffer.storage.file module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.storage.queue.html">trinity.buffer.storage.queue module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.storage.sql.html">trinity.buffer.storage.sql module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.writer.html">trinity.buffer.writer package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.writer.file_writer.html">trinity.buffer.writer.file_writer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.writer.queue_writer.html">trinity.buffer.writer.queue_writer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.writer.sql_writer.html">trinity.buffer.writer.sql_writer module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.buffer.html">trinity.buffer.buffer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.buffer_reader.html">trinity.buffer.buffer_reader module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.buffer_writer.html">trinity.buffer.buffer_writer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.task_scheduler.html">trinity.buffer.task_scheduler module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.utils.html">trinity.buffer.utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.viewer.html">trinity.buffer.viewer module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.explorer.html">trinity.explorer package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.explorer.proxy.html">trinity.explorer.proxy package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.explorer.proxy.app.html">trinity.explorer.proxy.app module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.explorer.proxy.client.html">trinity.explorer.proxy.client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.explorer.proxy.recorder.html">trinity.explorer.proxy.recorder module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.explorer.proxy.service.html">trinity.explorer.proxy.service module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.explorer.explorer.html">trinity.explorer.explorer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.explorer.scheduler.html">trinity.explorer.scheduler module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.explorer.workflow_runner.html">trinity.explorer.workflow_runner module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.trainer.html">trinity.trainer package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.trainer.tinker.html">trinity.trainer.tinker package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.tinker.utils.html">trinity.trainer.tinker.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.trainer.verl.html">trinity.trainer.verl package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.dp_actor.html">trinity.trainer.verl.dp_actor module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.fsdp_checkpoint_manager.html">trinity.trainer.verl.fsdp_checkpoint_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.fsdp_workers.html">trinity.trainer.verl.fsdp_workers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.megatron_actor.html">trinity.trainer.verl.megatron_actor module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.megatron_checkpoint_manager.html">trinity.trainer.verl.megatron_checkpoint_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.megatron_workers.html">trinity.trainer.verl.megatron_workers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.utils.html">trinity.trainer.verl.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.trainer.tinker_trainer.html">trinity.trainer.tinker_trainer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.trainer.trainer.html">trinity.trainer.trainer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.trainer.verl_trainer.html">trinity.trainer.verl_trainer module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.html">trinity.algorithm package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.html">trinity.algorithm.advantage_fn package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.advantage_fn.html">trinity.algorithm.advantage_fn.advantage_fn module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.asymre_advantage.html">trinity.algorithm.advantage_fn.asymre_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.grpo_advantage.html">trinity.algorithm.advantage_fn.grpo_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.multi_step_grpo_advantage.html">trinity.algorithm.advantage_fn.multi_step_grpo_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.on_policy_distill_advantage.html">trinity.algorithm.advantage_fn.on_policy_distill_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.opmd_advantage.html">trinity.algorithm.advantage_fn.opmd_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.ppo_advantage.html">trinity.algorithm.advantage_fn.ppo_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.rec_advantage.html">trinity.algorithm.advantage_fn.rec_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.reinforce_advantage.html">trinity.algorithm.advantage_fn.reinforce_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.reinforce_plus_plus_advantage.html">trinity.algorithm.advantage_fn.reinforce_plus_plus_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.remax_advantage.html">trinity.algorithm.advantage_fn.remax_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.rloo_advantage.html">trinity.algorithm.advantage_fn.rloo_advantage module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.entropy_loss_fn.html">trinity.algorithm.entropy_loss_fn package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.entropy_loss_fn.entropy_loss_fn.html">trinity.algorithm.entropy_loss_fn.entropy_loss_fn module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.kl_fn.html">trinity.algorithm.kl_fn package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.kl_fn.kl_fn.html">trinity.algorithm.kl_fn.kl_fn module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.html">trinity.algorithm.policy_loss_fn package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.chord_policy_loss.html">trinity.algorithm.policy_loss_fn.chord_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.cispo_policy_loss.html">trinity.algorithm.policy_loss_fn.cispo_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.dpo_loss.html">trinity.algorithm.policy_loss_fn.dpo_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.gspo_policy_loss.html">trinity.algorithm.policy_loss_fn.gspo_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.importance_sampling_policy_loss.html">trinity.algorithm.policy_loss_fn.importance_sampling_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.mix_policy_loss.html">trinity.algorithm.policy_loss_fn.mix_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.opmd_policy_loss.html">trinity.algorithm.policy_loss_fn.opmd_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.policy_loss_fn.html">trinity.algorithm.policy_loss_fn.policy_loss_fn module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.ppo_policy_loss.html">trinity.algorithm.policy_loss_fn.ppo_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.rec_policy_loss.html">trinity.algorithm.policy_loss_fn.rec_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.sapo_policy_loss.html">trinity.algorithm.policy_loss_fn.sapo_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.sft_loss.html">trinity.algorithm.policy_loss_fn.sft_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.sppo_loss_fn.html">trinity.algorithm.policy_loss_fn.sppo_loss_fn module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.topr_policy_loss.html">trinity.algorithm.policy_loss_fn.topr_policy_loss module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.sample_strategy.html">trinity.algorithm.sample_strategy package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.sample_strategy.mix_sample_strategy.html">trinity.algorithm.sample_strategy.mix_sample_strategy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.sample_strategy.sample_strategy.html">trinity.algorithm.sample_strategy.sample_strategy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.sample_strategy.utils.html">trinity.algorithm.sample_strategy.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.algorithm.algorithm.html">trinity.algorithm.algorithm module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.algorithm.key_mapper.html">trinity.algorithm.key_mapper module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.algorithm.utils.html">trinity.algorithm.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.manager.html">trinity.manager package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.manager.config_registry.html">trinity.manager.config_registry package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.algorithm_config_manager.html">trinity.manager.config_registry.algorithm_config_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.buffer_config_manager.html">trinity.manager.config_registry.buffer_config_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.config_registry.html">trinity.manager.config_registry.config_registry module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.explorer_config_manager.html">trinity.manager.config_registry.explorer_config_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.model_config_manager.html">trinity.manager.config_registry.model_config_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.trainer_config_manager.html">trinity.manager.config_registry.trainer_config_manager module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.manager.config_manager.html">trinity.manager.config_manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.manager.state_manager.html">trinity.manager.state_manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.manager.synchronizer.html">trinity.manager.synchronizer module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.common.html">trinity.common package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.common.models.html">trinity.common.models package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.vllm_patch.html">trinity.common.models.vllm_patch package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.mm_utils.html">trinity.common.models.mm_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.model.html">trinity.common.models.model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.tinker_model.html">trinity.common.models.tinker_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.utils.html">trinity.common.models.utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.vllm_model.html">trinity.common.models.vllm_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.vllm_worker.html">trinity.common.models.vllm_worker module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.common.rewards.html">trinity.common.rewards package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.accuracy_reward.html">trinity.common.rewards.accuracy_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.agents_reward.html">trinity.common.rewards.agents_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.countdown_reward.html">trinity.common.rewards.countdown_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.dapo_reward.html">trinity.common.rewards.dapo_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.eval_utils.html">trinity.common.rewards.eval_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.format_reward.html">trinity.common.rewards.format_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.human_reward.html">trinity.common.rewards.human_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.math_reward.html">trinity.common.rewards.math_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.naive_dapo_score.html">trinity.common.rewards.naive_dapo_score module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.qwen25_eval.html">trinity.common.rewards.qwen25_eval module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.reward_fn.html">trinity.common.rewards.reward_fn module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.tool_reward.html">trinity.common.rewards.tool_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.utils.html">trinity.common.rewards.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.common.workflows.html">trinity.common.workflows package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.agentscope.html">trinity.common.workflows.agentscope package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.agentscope_workflow.html">trinity.common.workflows.agentscope_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.customized_math_workflows.html">trinity.common.workflows.customized_math_workflows module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.customized_toolcall_workflows.html">trinity.common.workflows.customized_toolcall_workflows module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.eval_workflow.html">trinity.common.workflows.eval_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.math_rm_workflow.html">trinity.common.workflows.math_rm_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.math_ruler_workflow.html">trinity.common.workflows.math_ruler_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.math_trainable_ruler_workflow.html">trinity.common.workflows.math_trainable_ruler_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.on_policy_distill_workflow.html">trinity.common.workflows.on_policy_distill_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.rubric_judge_workflow.html">trinity.common.workflows.rubric_judge_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.simple_mm_workflow.html">trinity.common.workflows.simple_mm_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.step_wise_workflow.html">trinity.common.workflows.step_wise_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.workflow.html">trinity.common.workflows.workflow module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.common.config.html">trinity.common.config module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.common.constants.html">trinity.common.constants module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.common.experience.html">trinity.common.experience module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.common.verl_config.html">trinity.common.verl_config module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.utils.html">trinity.utils package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.annotations.html">trinity.utils.annotations module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.distributed.html">trinity.utils.distributed module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.dlc_utils.html">trinity.utils.dlc_utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.log.html">trinity.utils.log module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.lora_utils.html">trinity.utils.lora_utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.monitor.html">trinity.utils.monitor module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.plugin_loader.html">trinity.utils.plugin_loader module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.registry.html">trinity.utils.registry module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.timer.html">trinity.utils.timer module</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">
<div class="header-extra-switchers" style="display:inline-flex; gap:.25rem; margin-left:.5rem; align-items:center;">
  <button id="lang-toggle-btn" class="btn btn-sm btn-outline-secondary" title="">
  <span id="lang-toggle-label"></span>
</button>
<script>
(function () {
  const btn = document.getElementById('lang-toggle-btn');
  const lab = document.getElementById('lang-toggle-label');
  if (!btn || !lab) return;

  const m = location.pathname.match(/^(.*\/)(en|zh)(\/.*)$/);

  const cur = m ? m[2] : 'en';
  if (cur === 'en') {
    lab.textContent = '‰∏≠';
    btn.title = 'ÂàáÊç¢Âà∞‰∏≠Êñá';
  } else {
    lab.textContent = 'EN';
    btn.title = 'Switch to English';
  }

  const targetHref = (function () {
    if (!m) return location.href;
    const other = cur === 'en' ? 'zh' : 'en';
    const suffix = m[3] || '/';
    return m[1] + other + suffix + location.search + location.hash;
  })();

  btn.addEventListener('click', function () {
    location.href = targetHref;
  });
})();
</script>
</div>



<div class="article-header-buttons">


<a href="https://github.com/modelscope/Trinity-RFT" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tutorial/align_with_verl.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Align configuration with veRL</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-mapping">Parameter Mapping</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algorithm">Algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#actor-rollout-and-critic">Actor, Rollout, and Critic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reward-model">Reward Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trainer">Trainer</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gpu-resource-allocation">GPU Resource Allocation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics-mapping">Metrics Mapping</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-we-see-two-runs-for-each-experiment">Why do we see two runs for each experiment?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-are-some-metrics-different-from-verl">Why are some metrics different from veRL?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-ppo-training">Example: PPO Training</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-grpo-training">Example: GRPO Training</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="align-configuration-with-verl">
<h1>Align configuration with veRL<a class="headerlink" href="#align-configuration-with-verl" title="Link to this heading">#</a></h1>
<p>This guide provides guidance for users familiar with <a class="reference external" href="https://github.com/volcengine/verl">veRL</a> to align the parameters and metrics in Trinity-RFT with the ones in veRL.</p>
<p>Trinity-RFT uses <a class="reference external" href="https://github.com/volcengine/verl">veRL</a> as the training backend (<code class="docutils literal notranslate"><span class="pre">trainer</span></code>), including the actor, reference, and critic models. The <code class="docutils literal notranslate"><span class="pre">explorer</span></code> module in Trinity-RFT is implemented based on <a class="reference external" href="https://github.com/vllm-project/vllm">vllm</a>, replacing veRL‚Äôs native rollout engine. Besides, Trinity-RFT introduces a new module <code class="docutils literal notranslate"><span class="pre">buffer</span></code> to enhance RFT‚Äôs full-lifecycle data pipeline, which can be understood as a further enhancement of veRL‚Äôs RL dataset and DataProto.</p>
<section id="parameter-mapping">
<h2>Parameter Mapping<a class="headerlink" href="#parameter-mapping" title="Link to this heading">#</a></h2>
<p>The core parameters in veRL are divided into these categories: <code class="docutils literal notranslate"><span class="pre">algorithm</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">actor_rollout_ref</span></code>, <code class="docutils literal notranslate"><span class="pre">critic</span></code>, <code class="docutils literal notranslate"><span class="pre">reward_model</span></code>, and <code class="docutils literal notranslate"><span class="pre">trainer</span></code>.
Trinity-RFT divides massive parameters of reinforcement fine-tuning into several parts according to their functions, e.g., <code class="docutils literal notranslate"><span class="pre">algorithm</span></code>, <code class="docutils literal notranslate"><span class="pre">model</span></code>, <code class="docutils literal notranslate"><span class="pre">buffer</span></code>, <code class="docutils literal notranslate"><span class="pre">explorer</span></code>, <code class="docutils literal notranslate"><span class="pre">trainer</span></code>, <code class="docutils literal notranslate"><span class="pre">monitor</span></code>, <code class="docutils literal notranslate"><span class="pre">synchronizer</span></code>, and <code class="docutils literal notranslate"><span class="pre">cluster</span></code>.</p>
<p>Roughly speaking, the parameters in veRL are mapped to the following modules in Trinity-RFT:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Configuration</p></th>
<th class="head text-left"><p>veRL</p></th>
<th class="head text-left"><p>Trinity-RFT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Algorithm, e.g., advantage function</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Training and evaluation tasksets</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Batch size (üí° explained later)</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.train_batch_size</span></code> and <code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.ppo_mini_batch_size</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.batch_size</span></code> and <code class="docutils literal notranslate"><span class="pre">buffer.train_batch_size</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Actor</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">model</span></code> and <code class="docutils literal notranslate"><span class="pre">trainer</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Rollout</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">explorer.rollout_model</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Critic</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">critic</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.trainer_config.critic</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Reward model</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">reward_model</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">explorer.auxiliary_models</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Some global configurations</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">monitor</span></code>, <code class="docutils literal notranslate"><span class="pre">synchronizer</span></code>, <code class="docutils literal notranslate"><span class="pre">cluster</span></code>, etc</p></td>
</tr>
</tbody>
</table>
</div>
<p>In the following, we show how to map the parameters in veRL to the ones in Trinity-RFT. Please refer to the <a class="reference external" href="https://modelscope.github.io/Trinity-RFT/en/main/tutorial/trinity_configs.html">documentation</a> for the detailed parameter configuration of Trinity-RFT.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To match the default training setup of veRL, we set <code class="docutils literal notranslate"><span class="pre">synchronizer.sync_style=fixed</span></code> and <code class="docutils literal notranslate"><span class="pre">synchronizer.sync_offset=0</span></code> in Trinity-RFT.</p>
</div>
<section id="algorithm">
<h3>Algorithm<a class="headerlink" href="#algorithm" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>veRL</p></th>
<th class="head text-left"><p>Trinity-RFT</p></th>
<th class="head text-left"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.adv_estimator</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.advantage_fn</span></code></p></td>
<td class="text-left"><p>Pass parameters with <code class="docutils literal notranslate"><span class="pre">algorithm.advantage_fn_args</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.gamma</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.advantage_fn_args.gamma</span></code></p></td>
<td class="text-left"><p>Along with <code class="docutils literal notranslate"><span class="pre">algorithm.advantage_fn:</span> <span class="pre">ppo/reinforceplusplus</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.lam</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.advantage_fn_args.lam</span></code></p></td>
<td class="text-left"><p>Along with <code class="docutils literal notranslate"><span class="pre">algorithm.advantage_fn:</span> <span class="pre">ppo</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.use_kl_in_reward</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.kl_penalty_fn</span></code></p></td>
<td class="text-left"><p>Disable KL in reward by setting <code class="docutils literal notranslate"><span class="pre">algorithm.kl_penalty_fn=none</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.kl_penalty</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.kl_penalty_fn</span></code></p></td>
<td class="text-left"><p>Choose from <code class="docutils literal notranslate"><span class="pre">k2</span></code>, <code class="docutils literal notranslate"><span class="pre">low_var_kl</span></code>, etc</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.kl_ctrl.kl_coef</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.kl_penalty_fn_args.kl_coef</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
</tbody>
</table>
</div>
<p>üí° Detailed explanation:</p>
<ul class="simple">
<li><p>Before using args of advantage function or policy loss function (e.g., <code class="docutils literal notranslate"><span class="pre">algorithm.kl_penalty_fn_args</span></code>), a good practice is to check the source code to ensure these parameters can be processed by the corresponding function properly.</p></li>
</ul>
</section>
<section id="data">
<h3>Data<a class="headerlink" href="#data" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>veRL</p></th>
<th class="head text-left"><p>Trinity-RFT</p></th>
<th class="head text-left"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.train_files</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.taskset.path</span></code> or <code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.tasksets[i].path</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.val_files</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.eval_tasksets[i].path</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.prompt_key</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.taskset.format.prompt_key</span></code></p></td>
<td class="text-left"><p>Taskset-specific</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.response_key</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.taskset.format.response_key</span></code></p></td>
<td class="text-left"><p>Taskset-specific</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.train_batch_size</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.batch_size</span></code> * <code class="docutils literal notranslate"><span class="pre">synchronizer.sync_interval</span></code></p></td>
<td class="text-left"><p>The number of tasks to be explored</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.val_batch_size</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.batch_size</span></code></p></td>
<td class="text-left"><p>Deprecated in veRL</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.max_prompt_length</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">model.max_prompt_tokens</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.max_response_length</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">model.max_response_tokens</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.filter_overlong_prompts</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">model.enable_prompt_truncation</span></code></p></td>
<td class="text-left"><p>Explained later</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.truncation</span></code></p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p>Equivalent to <code class="docutils literal notranslate"><span class="pre">right</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">data.shuffle</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.taskset.task_selector.selector_type:shuffle</span></code></p></td>
<td class="text-left"><p>Taskset-specific</p></td>
</tr>
</tbody>
</table>
</div>
<p>üí° Detailed explanation:</p>
<ul class="simple">
<li><p>The note <code class="docutils literal notranslate"><span class="pre">taskset-specific</span></code> means you can set different parameters for each training or evaluation task in <code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.tasksets[i]</span></code> or <code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.eval_tasksets[i]</span></code>.</p></li>
<li><p>For the parameters related to <code class="docutils literal notranslate"><span class="pre">batch</span> <span class="pre">size</span></code>, Trinity-RFT uses <code class="docutils literal notranslate"><span class="pre">buffer.batch_size</span></code> to control the number of tasks to be explored in each exploration step, and <code class="docutils literal notranslate"><span class="pre">buffer.train_batch_size</span></code> to control the number of tasks used in each gradient descent step. In most cases, controlling the following parameters can ensure the same effect as veRL:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer.batch_size</span></code> in Trinity-RFT = <code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.ppo_mini_batch_size</span></code> in veRL</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer.train_batch_size</span></code> in Trinity-RFT (automatically) = <code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout.n</span></code> * <code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.ppo_mini_batch_size</span></code> in veRL</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">synchronizer.sync_interval</span></code> in Trinity-RFT =  <code class="docutils literal notranslate"><span class="pre">data.train_batch_size</span></code> / <code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.ppo_mini_batch_size</span></code> in veRL</p></li>
<li><p>Do not set <code class="docutils literal notranslate"><span class="pre">ppo_mini_batch_size</span></code>, which is automatically set to match the effect of veRL, although the values may not be the same.</p></li>
</ul>
</li>
<li><p>If you want to filter the overlong prompts, you can set <code class="docutils literal notranslate"><span class="pre">model.enable_prompt_truncation=True</span></code> in Trinity-RFT. In this case, the corresponding experiences will not be counted in loss computation, and thus <code class="docutils literal notranslate"><span class="pre">truncation</span></code> side does not matter anymore.</p></li>
</ul>
</section>
<section id="actor-rollout-and-critic">
<h3>Actor, Rollout, and Critic<a class="headerlink" href="#actor-rollout-and-critic" title="Link to this heading">#</a></h3>
<p>This section includes the parameters for the actor and the rollout. For easy understanding, you may think the actor in veRL (<code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor</span></code>) as the trainer in Trinity-RFT (<code class="docutils literal notranslate"><span class="pre">trainer</span></code>), and the rollout (<code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout</span></code>) as the explorer (<code class="docutils literal notranslate"><span class="pre">explorer.rollout_model</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Any parameter in <code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout</span></code> in Trinity-RFT is not effective; please set them in other fields properly.</p>
</div>
<p>For advanced training configuration of veRL you can set these up in the field of <code class="docutils literal notranslate"><span class="pre">trainer.trainer_config</span></code>. For example,<code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.ppo_micro_batch_size_per_gpu</span></code> in veRL is equivalent to <code class="docutils literal notranslate"><span class="pre">trainer.trainer_config.actor_rollout_ref.actor.ppo_micro_batch_size_per_gpu</span></code> in Trinity-RFT. If you want to setup the parameters in the <code class="docutils literal notranslate"><span class="pre">trainer.trainer_config</span></code> dictionary, please read the source code in <code class="docutils literal notranslate"><span class="pre">trinity/common/verl_config.py</span></code> carefully!</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>veRL</p></th>
<th class="head text-left"><p>Trinity-RFT</p></th>
<th class="head text-left"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.model.path</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">model.model_path</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.optim</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.optimizer</span></code></p></td>
<td class="text-left"><p>Such as <code class="docutils literal notranslate"><span class="pre">lr</span></code> and <code class="docutils literal notranslate"><span class="pre">weight_decay</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout.n</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.repeat_times</span></code></p></td>
<td class="text-left"><p>Eval taskset-specific: <code class="docutils literal notranslate"><span class="pre">eval_tasksets[i].repeat_times</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.ppo_mini_batch_size</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.batch_size</span></code></p></td>
<td class="text-left"><p>The number of tasks to be explored in each exploration step</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.use_dynamic_bsz</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.use_dynamic_bsz</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.ppo_max_token_len_per_gpu</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.max_token_len_per_gpu</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.ulysses_sequence_parallel_size</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.ulysses_sequence_parallel_size</span></code></p></td>
<td class="text-left"><p>The sequence parallel size for the actor</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.grad_clip</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.grad_clip</span></code></p></td>
<td class="text-left"><p>The gradient clip value for the actor</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.use_kl_loss</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">algorithm.kl_loss_fn</span></code></p></td>
<td class="text-left"><p>If set to <code class="docutils literal notranslate"><span class="pre">none</span></code>, the KL divergence loss will not be computed</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout.gpu_memory_utilization</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">explorer.rollout_model.gpu_memory_utilization</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout.temperature</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">model.temperature</span></code></p></td>
<td class="text-left"><p>Can be taskset-specific, like <code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.taskset.rollout_args.temperature</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout.top_p</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">model.top_p</span></code></p></td>
<td class="text-left"><p>Can be taskset-specific</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout.top_k</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">model.top_k</span></code></p></td>
<td class="text-left"><p>Can be taskset-specific</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout.tensor_model_parallel_size</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">explorer.rollout_model.tensor_parallel_size</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.rollout.val_kwargs</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.eval_tasksets[i]</span></code></p></td>
<td class="text-left"><p>Taskset-specific</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">critic.model.path</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">model.critic_model_path</span></code></p></td>
<td class="text-left"><p>Defaults to <code class="docutils literal notranslate"><span class="pre">model.model_path</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>üí° Detailed explanation:</p>
<ul class="simple">
<li><p>The note <code class="docutils literal notranslate"><span class="pre">can</span> <span class="pre">be</span> <span class="pre">taskset-specific</span></code> (take <code class="docutils literal notranslate"><span class="pre">temperature</span></code> as an example) means you can set <code class="docutils literal notranslate"><span class="pre">model.temperature</span></code> for all the tasksets, or set different values for each task in <code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.taskset.rollout_args.temperature</span></code> or <code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.eval_tasksets[i].rollout_args.temperature</span></code>. A concrete example is as follows:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">buffer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">explorer_input</span><span class="p">:</span>
<span class="w">    </span><span class="nt">eval_tasksets</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AIME2024</span>
<span class="w">        </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HuggingFaceH4/aime_2024</span>
<span class="w">        </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;train&#39;</span>
<span class="w">        </span><span class="nt">repeat_times</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;question&#39;</span>
<span class="w">          </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;answer&#39;</span>
<span class="w">        </span><span class="nt">rollout_args</span><span class="p">:</span>
<span class="w">          </span><span class="nt">temperature</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">          </span><span class="nt">top_p</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.7</span>
</pre></div>
</div>
</section>
<section id="reward-model">
<h3>Reward Model<a class="headerlink" href="#reward-model" title="Link to this heading">#</a></h3>
<p>Trinity-RFT supports the taskset-specific reward functions as well as the reward models. For custom reward functions, you can set <code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.default_reward_fn_type</span></code> to select the corresponding reward function; you can also set <code class="docutils literal notranslate"><span class="pre">explorer.auxiliary_models</span></code> as reward model and use them within your workflow. For example,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">buffer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">explorer_input</span><span class="p">:</span>
<span class="w">    </span><span class="nt">default_reward_fn_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;custom_reward&#39;</span>
<span class="nt">explorer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auxiliary_models</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Qwen/Qwen3-30B-A3B-Instruct-2507</span>
<span class="w">      </span><span class="nt">engine_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">tensor_parallel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">      </span><span class="nt">enable_thinking</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">max_prompt_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">19456</span>
<span class="w">      </span><span class="nt">max_response_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span>
<span class="w">      </span><span class="nt">max_model_len</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20480</span>
</pre></div>
</div>
<p>Please refer to the <a class="reference external" href="https://github.com/modelscope/Trinity-RFT/blob/main/examples/grpo_rubric_as_reward/rubric.yaml">configuration</a> and <a class="reference external" href="https://github.com/modelscope/Trinity-RFT/blob/main/trinity/common/workflows/rubric_judge_workflow.py">workflow</a> with LLM-as-a-judge for more details.</p>
</section>
<section id="trainer">
<h3>Trainer<a class="headerlink" href="#trainer" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>veRL</p></th>
<th class="head text-left"><p>Trinity-RFT</p></th>
<th class="head text-left"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.logger</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">monitor.monitor_type</span></code></p></td>
<td class="text-left"><p>Support a chosen type and (no need to set) <code class="docutils literal notranslate"><span class="pre">console</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.project_name</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">project</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.experiment_name</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.default_local_dir</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">checkpoint_root_dir</span></code></p></td>
<td class="text-left"><p>Checkpoint is saved in <code class="docutils literal notranslate"><span class="pre">&lt;checkpoint_root_dir&gt;/&lt;project&gt;/&lt;name&gt;/</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.n_gpus_per_node</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">cluster.gpu_per_node</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.nnodes</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">cluster.node_num</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.save_freq</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.save_interval</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.test_freq</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">explorer.eval_interval</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.total_epochs</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.total_epochs</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.total_training_steps</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">buffer.total_steps</span></code> and <code class="docutils literal notranslate"><span class="pre">trainer.total_steps</span></code></p></td>
<td class="text-left"><p>If not None, <code class="docutils literal notranslate"><span class="pre">buffer.total_epochs</span></code> will be ignored</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.critic_warmup</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.trainer_config.trainer.critic_warmup</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.val_before_train</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">explorer.eval_on_startup</span></code></p></td>
<td class="text-left"><p>-</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.resume_mode</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">continue_from_checkpoint</span></code></p></td>
<td class="text-left"><p>Explained later</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">trainer.resume_from_path</span></code></p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p>Explained later</p></td>
</tr>
</tbody>
</table>
</div>
<p>üí° Detailed explanation:</p>
<ul class="simple">
<li><p>If you want to resume training from a checkpoint, you can set <code class="docutils literal notranslate"><span class="pre">continue_from_checkpoint</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> and the training will start from the latest checkpoint in the checkpoint path <code class="docutils literal notranslate"><span class="pre">&lt;checkpoint_root_dir&gt;/&lt;project&gt;/&lt;name&gt;/</span></code> (if any).</p></li>
</ul>
</section>
</section>
<section id="gpu-resource-allocation">
<h2>GPU Resource Allocation<a class="headerlink" href="#gpu-resource-allocation" title="Link to this heading">#</a></h2>
<p>In Trinity-RFT, the GPU resource is allocated to the <code class="docutils literal notranslate"><span class="pre">explorer</span></code>, <code class="docutils literal notranslate"><span class="pre">auxiliary</span> <span class="pre">models</span></code> (if any), and <code class="docutils literal notranslate"><span class="pre">trainer</span></code> manually.</p>
<ul class="simple">
<li><p>There are total <code class="docutils literal notranslate"><span class="pre">cluster.node_num</span></code> nodes, and each node has <code class="docutils literal notranslate"><span class="pre">cluster.gpu_per_node</span></code> GPUs.</p></li>
<li><p>The number of GPUs for the <code class="docutils literal notranslate"><span class="pre">explorer</span></code> is <code class="docutils literal notranslate"><span class="pre">explorer.rollout_model.engine_num</span></code> * <code class="docutils literal notranslate"><span class="pre">explorer.rollout_model.tensor_parallel_size</span></code>.</p></li>
<li><p>The number of GPUs for auxiliary models is the sum of <code class="docutils literal notranslate"><span class="pre">explorer.auxiliary_models[i].engine_num</span></code> * <code class="docutils literal notranslate"><span class="pre">explorer.auxiliary_models[i].tensor_parallel_size</span></code>.</p></li>
<li><p>The remaining GPUs are for the <code class="docutils literal notranslate"><span class="pre">trainer</span></code>.</p></li>
</ul>
</section>
<section id="metrics-mapping">
<h2>Metrics Mapping<a class="headerlink" href="#metrics-mapping" title="Link to this heading">#</a></h2>
<section id="why-do-we-see-two-runs-for-each-experiment">
<h3>Why do we see two runs for each experiment?<a class="headerlink" href="#why-do-we-see-two-runs-for-each-experiment" title="Link to this heading">#</a></h3>
<p>In Trinity-RFT, the explorer is responsible for the rollout process, while the trainer is responsible for the training process. Metrics from these two processes are calculated independently and uploaded to the monitor as separate runs. This is why you will see two runs for each experiment, distinguished by the ‚Äú_explorer‚Äù or ‚Äú_trainer‚Äù suffix.</p>
</section>
<section id="why-are-some-metrics-different-from-verl">
<h3>Why are some metrics different from veRL?<a class="headerlink" href="#why-are-some-metrics-different-from-verl" title="Link to this heading">#</a></h3>
<p>Trinity-RFT uses <a class="reference external" href="https://github.com/vllm-project/vllm">vllm</a> as the rollout engine and veRL as the training backend. Due to precision differences between these frameworks, the log probabilities computed on the given tokens may differ. As a result, some metrics (e.g., <code class="docutils literal notranslate"><span class="pre">actor/ppo_kl</span></code> and <code class="docutils literal notranslate"><span class="pre">actor/pg_clipfrac</span></code>) may differ from those observed in veRL. However, when using the same parameters with veRL, these differences are expected to be small.</p>
</section>
</section>
<section id="example-ppo-training">
<h2>Example: PPO Training<a class="headerlink" href="#example-ppo-training" title="Link to this heading">#</a></h2>
<p>We transfer a PPO training example <code class="docutils literal notranslate"><span class="pre">run_qwen2-7b_rm.sh</span></code> from veRL to Trinity-RFT.</p>
<p>The configuration file of veRL is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">gsm8k_train_path</span><span class="o">=</span><span class="nv">$HOME</span>/data/gsm8k/train.parquet
<span class="nv">gsm8k_test_path</span><span class="o">=</span><span class="nv">$HOME</span>/data/gsm8k/test.parquet
<span class="nv">math_train_path</span><span class="o">=</span><span class="nv">$HOME</span>/data/math/train.parquet
<span class="nv">math_test_path</span><span class="o">=</span><span class="nv">$HOME</span>/data/math/test.parquet

<span class="nv">train_files</span><span class="o">=</span><span class="s2">&quot;[&#39;</span><span class="nv">$gsm8k_train_path</span><span class="s2">&#39;, &#39;</span><span class="nv">$math_train_path</span><span class="s2">&#39;]&quot;</span>
<span class="nv">test_files</span><span class="o">=</span><span class="s2">&quot;[&#39;</span><span class="nv">$gsm8k_test_path</span><span class="s2">&#39;, &#39;</span><span class="nv">$math_test_path</span><span class="s2">&#39;]&quot;</span>

<span class="c1"># prepare model ckpt</span>
huggingface-cli<span class="w"> </span>download<span class="w"> </span>Qwen/Qwen2-7B-Instruct<span class="w"> </span>--local-dir<span class="w"> </span><span class="nv">$HOME</span>/models/Qwen2-7B-Instruct<span class="w"> </span><span class="p">&amp;</span>
huggingface-cli<span class="w"> </span>download<span class="w"> </span>sfairXC/FsfairX-LLaMA3-RM-v0.1<span class="w"> </span>--local-dir<span class="w"> </span><span class="nv">$HOME</span>/models/FsfairX-LLaMA3-RM-v0.1<span class="w"> </span><span class="p">&amp;</span>
<span class="nb">wait</span>

python3<span class="w"> </span>-m<span class="w"> </span>verl.trainer.main_ppo<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>algorithm.adv_estimator<span class="o">=</span>gae<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.train_files<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$train_files</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.val_files<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$test_files</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.train_batch_size<span class="o">=</span><span class="m">1024</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.max_prompt_length<span class="o">=</span><span class="m">1024</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.max_response_length<span class="o">=</span><span class="m">512</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.filter_overlong_prompts<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.truncation<span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.return_raw_chat<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.model.path<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/models/Qwen2-7B-Instruct&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.optim.lr<span class="o">=</span>1e-6<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.model.use_remove_padding<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.optim.lr_warmup_steps_ratio<span class="o">=</span><span class="m">0</span>.1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.ppo_mini_batch_size<span class="o">=</span><span class="m">256</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.ppo_micro_batch_size_per_gpu<span class="o">=</span><span class="m">16</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.use_kl_loss<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.model.enable_gradient_checkpointing<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.fsdp_config.param_offload<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.fsdp_config.optimizer_offload<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.rollout.log_prob_micro_batch_size_per_gpu<span class="o">=</span><span class="m">16</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.rollout.tensor_model_parallel_size<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.rollout.name<span class="o">=</span>vllm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.rollout.gpu_memory_utilization<span class="o">=</span><span class="m">0</span>.6<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>critic.optim.lr<span class="o">=</span>1e-5<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>critic.model.use_remove_padding<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>critic.optim.lr_warmup_steps_ratio<span class="o">=</span><span class="m">0</span>.05<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>critic.model.path<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/models/Qwen2-7B-Instruct&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>critic.model.enable_gradient_checkpointing<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>critic.ppo_micro_batch_size_per_gpu<span class="o">=</span><span class="m">32</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>critic.model.fsdp_config.param_offload<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>critic.model.fsdp_config.optimizer_offload<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>reward_model.enable<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>reward_model.model.path<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/models/FsfairX-LLaMA3-RM-v0.1&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>reward_model.model.use_remove_padding<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>reward_model.model.fsdp_config.param_offload<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>reward_model.micro_batch_size_per_gpu<span class="o">=</span><span class="m">32</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>algorithm.use_kl_in_reward<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.critic_warmup<span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.logger<span class="o">=</span><span class="s1">&#39;[&quot;console&quot;,&quot;wandb&quot;]&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.project_name<span class="o">=</span><span class="s1">&#39;verl_example&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.val_before_train<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.experiment_name<span class="o">=</span><span class="s1">&#39;Qwen2-7B-Instruct_hybrid_rm&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.n_gpus_per_node<span class="o">=</span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.nnodes<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.save_freq<span class="o">=</span><span class="m">20</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.test_freq<span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.total_epochs<span class="o">=</span><span class="m">15</span><span class="w"> </span><span class="nv">$@</span>
</pre></div>
</div>
<p>The corresponding configuration of Trinity-RFT (ppo_example.yaml) is as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verl_example</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Qwen2-7B-Instruct_hybrid_rm</span>
<span class="nt">checkpoint_root_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./checkpoints</span>
<span class="nt">algorithm</span><span class="p">:</span>
<span class="w">  </span><span class="nt">algorithm_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ppo</span>
<span class="w">  </span><span class="nt">repeat_times</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">optimizer</span><span class="p">:</span>
<span class="w">    </span><span class="nt">lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1e-6</span>
<span class="w">    </span><span class="nt">lr_warmup_steps_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.optim.lr_warmup_steps_ratio</span>
<span class="w">  </span><span class="nt">advantage_fn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ppo</span><span class="w">  </span><span class="c1"># algorithm.adv_estimator=gae</span>
<span class="w">  </span><span class="nt">kl_penalty_fn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span><span class="w">  </span><span class="c1"># algorithm.use_kl_in_reward=False</span>
<span class="w">  </span><span class="nt">kl_loss_fn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.use_kl_loss=False</span>

<span class="nt">model</span><span class="p">:</span>
<span class="w">  </span><span class="nt">model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:HOME}/models/Qwen2-7B-Instruct</span>
<span class="w">  </span><span class="nt">critic_model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:HOME}/models/Qwen2-7B-Instruct</span><span class="w">  </span><span class="c1"># critic.model.path</span>
<span class="w">  </span><span class="nt">max_prompt_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span><span class="w">  </span><span class="c1"># data.max_prompt_length</span>
<span class="w">  </span><span class="nt">max_response_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span><span class="w">  </span><span class="c1"># data.max_response_length</span>
<span class="w">  </span><span class="nt">enable_prompt_truncation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># data.filter_overlong_prompts=True</span>

<span class="nt">cluster</span><span class="p">:</span>
<span class="w">  </span><span class="nt">node_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># trainer.nnodes</span>
<span class="w">  </span><span class="nt">gpu_per_node</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span><span class="w">  </span><span class="c1"># trainer.n_gpus_per_node</span>

<span class="nt">buffer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">total_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w">  </span><span class="c1"># trainer.total_epochs</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.ppo_mini_batch_size</span>
<span class="w">  </span><span class="nt">train_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.ppo_mini_batch_size * actor_rollout_ref.rollout.n=256*1=256</span>
<span class="w">  </span><span class="nt">explorer_input</span><span class="p">:</span>
<span class="w">    </span><span class="nt">tasksets</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gsm8k</span>
<span class="w">        </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:HOME}/data/gsm8k</span>
<span class="w">        </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prompt</span><span class="w">  </span><span class="c1"># Check the dataset format</span>
<span class="w">          </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">answer</span><span class="w"> </span><span class="c1"># Check the dataset format</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">math</span>
<span class="w">        </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:HOME}/data/math</span>
<span class="w">        </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prompt</span><span class="w">  </span><span class="c1"># Check the dataset format</span>
<span class="w">          </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">answer</span><span class="w"> </span><span class="c1"># Check the dataset format</span>
<span class="w">        </span><span class="nt">rollout_args</span><span class="p">:</span>
<span class="w">          </span><span class="nt">temperature</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">    </span><span class="nt">eval_tasksets</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gsm8k_eval</span>
<span class="w">        </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:HOME}/data/gsm8k</span>
<span class="w">        </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prompt</span><span class="w">  </span><span class="c1"># Check the dataset format</span>
<span class="w">          </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">answer</span><span class="w"> </span><span class="c1"># Check the dataset format</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">math_eval</span>
<span class="w">        </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:HOME}/data/math</span>
<span class="w">        </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prompt</span><span class="w">  </span><span class="c1"># Check the dataset format</span>
<span class="w">          </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">answer</span><span class="w"> </span><span class="c1"># Check the dataset format</span>

<span class="nt">explorer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">eval_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w">  </span><span class="c1"># trainer.test_freq</span>
<span class="w">  </span><span class="nt">eval_on_startup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># trainer.val_before_train=False</span>
<span class="w">  </span><span class="nt">rollout_model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">engine_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># The number of GPUs for the rollout model</span>
<span class="w">    </span><span class="nt">tensor_parallel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># actor_rollout_ref.rollout.tensor_model_parallel_size</span>
<span class="w">    </span><span class="nt">gpu_memory_utilization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.6</span><span class="w">  </span><span class="c1"># actor_rollout_ref.rollout.gpu_memory_utilization</span>
<span class="w">  </span><span class="nt">auxiliary_models</span><span class="p">:</span><span class="w">  </span><span class="c1"># reward_model configuration</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:HOME}/models/FsfairX-LLaMA3-RM-v0.1</span>
<span class="w">      </span><span class="nt">engine_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># The number of GPUs for the reward model</span>
<span class="w">      </span><span class="nt">tensor_parallel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="nt">synchronizer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">sync_style</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fixed</span>
<span class="w">  </span><span class="nt">sync_offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">sync_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w">  </span><span class="c1"># sync_interval = data.train_batch_size / actor_rollout_ref.actor.ppo_mini_batch_size</span>
<span class="w">  </span><span class="nt">sync_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1200</span>

<span class="nt">trainer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">save_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w">  </span><span class="c1"># trainer.save_freq</span>
<span class="w">  </span><span class="nt">trainer_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">actor_rollout_ref</span><span class="p">:</span>
<span class="w">      </span><span class="nt">model</span><span class="p">:</span>
<span class="w">        </span><span class="nt">use_remove_padding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># actor_rollout_ref.model.use_remove_padding</span>
<span class="w">        </span><span class="nt">enable_gradient_checkpointing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># actor_rollout_ref.model.enable_gradient_checkpointing</span>
<span class="w">      </span><span class="nt">actor</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ppo_micro_batch_size_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.ppo_micro_batch_size_per_gpu</span>
<span class="w">        </span><span class="nt">fsdp_config</span><span class="p">:</span>
<span class="w">          </span><span class="nt">param_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.fsdp_config.param_offload</span>
<span class="w">          </span><span class="nt">optimizer_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.fsdp_config.optimizer_offload</span>
<span class="w">      </span><span class="nt">rollout</span><span class="p">:</span>
<span class="w">        </span><span class="nt">log_prob_micro_batch_size_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span><span class="w">  </span><span class="c1"># actor_rollout_ref.rollout.log_prob_micro_batch_size_per_gpu</span>
<span class="w">    </span><span class="nt">critic</span><span class="p">:</span>
<span class="w">      </span><span class="nt">model</span><span class="p">:</span>
<span class="w">        </span><span class="nt">use_remove_padding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># critic.model.use_remove_padding</span>
<span class="w">        </span><span class="nt">enable_gradient_checkpointing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># critic.model.enable_gradient_checkpointing</span>
<span class="w">        </span><span class="nt">fsdp_config</span><span class="p">:</span>
<span class="w">          </span><span class="nt">param_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># critic.model.fsdp_config.param_offload</span>
<span class="w">          </span><span class="nt">optimizer_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># critic.model.fsdp_config.optimizer_offload</span>
<span class="w">      </span><span class="nt">optim</span><span class="p">:</span>
<span class="w">        </span><span class="nt">lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1e-5</span><span class="w">  </span><span class="c1"># critic.optim.lr</span>
<span class="w">        </span><span class="nt">lr_warmup_steps_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w">  </span><span class="c1"># critic.optim.lr_warmup_steps_ratio</span>
<span class="w">      </span><span class="nt">ppo_micro_batch_size_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span><span class="w">  </span><span class="c1"># critic.ppo_micro_batch_size_per_gpu</span>
<span class="w">    </span><span class="nt">trainer</span><span class="p">:</span>
<span class="w">      </span><span class="nt">critic_warmup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">  </span><span class="c1"># trainer.critic_warmup</span>

<span class="nt">monitor</span><span class="p">:</span>
<span class="w">  </span><span class="nt">monitor_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wandb</span><span class="w">  </span><span class="c1"># trainer.logger=&#39;[&quot;console&quot;,&quot;wandb&quot;]&#39; - wandb is the set value, console is default</span>
</pre></div>
</div>
<p>The command to run this example is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>trinity<span class="w"> </span>run<span class="w"> </span>--config<span class="w"> </span>ppo_example.yaml
</pre></div>
</div>
</section>
<section id="example-grpo-training">
<h2>Example: GRPO Training<a class="headerlink" href="#example-grpo-training" title="Link to this heading">#</a></h2>
<p>We transfer a GRPO training example <code class="docutils literal notranslate"><span class="pre">run_deepseek7b_llm_seq_balance.sh</span></code> from veRL to Trinity-RFT.</p>
<p>The configuration file of veRL is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="w"> </span>-x

python3<span class="w"> </span>-m<span class="w"> </span>verl.trainer.main_ppo<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>algorithm.adv_estimator<span class="o">=</span>grpo<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.train_files<span class="o">=</span><span class="nv">$HOME</span>/data/gsm8k/train.parquet<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.val_files<span class="o">=</span><span class="nv">$HOME</span>/data/gsm8k/test.parquet<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.train_batch_size<span class="o">=</span><span class="m">1024</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.max_prompt_length<span class="o">=</span><span class="m">512</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.max_response_length<span class="o">=</span><span class="m">512</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.filter_overlong_prompts<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.truncation<span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.model.path<span class="o">=</span>deepseek-ai/deepseek-llm-7b-chat<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.optim.lr<span class="o">=</span>1e-6<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.model.use_remove_padding<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.ppo_mini_batch_size<span class="o">=</span><span class="m">256</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.use_dynamic_bsz<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.ppo_max_token_len_per_gpu<span class="o">=</span><span class="m">24000</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.use_kl_loss<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.kl_loss_coef<span class="o">=</span><span class="m">0</span>.001<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.kl_loss_type<span class="o">=</span>low_var_kl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.entropy_coeff<span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.model.enable_gradient_checkpointing<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.fsdp_config.param_offload<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.actor.fsdp_config.optimizer_offload<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.rollout.tensor_model_parallel_size<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.rollout.name<span class="o">=</span>vllm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.rollout.gpu_memory_utilization<span class="o">=</span><span class="m">0</span>.6<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.rollout.n<span class="o">=</span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>actor_rollout_ref.ref.fsdp_config.param_offload<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>algorithm.use_kl_in_reward<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.critic_warmup<span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.logger<span class="o">=</span><span class="s1">&#39;[&quot;console&quot;,&quot;wandb&quot;]&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.project_name<span class="o">=</span><span class="s1">&#39;verl_grpo_example_gsm8k&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.experiment_name<span class="o">=</span><span class="s1">&#39;deepseek_llm_7b_function_rm_seq_packing&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.n_gpus_per_node<span class="o">=</span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.nnodes<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.save_freq<span class="o">=</span><span class="m">20</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.test_freq<span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>trainer.total_epochs<span class="o">=</span><span class="m">15</span><span class="w"> </span><span class="nv">$@</span>
</pre></div>
</div>
<p>The corresponding configuration of Trinity-RFT (grpo_example.yaml) is as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verl_grpo_example_gsm8k</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deepseek_llm_7b_function_rm_seq_packing</span>
<span class="nt">checkpoint_root_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./checkpoints</span>
<span class="nt">algorithm</span><span class="p">:</span>
<span class="w">  </span><span class="nt">algorithm_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grpo</span>
<span class="w">  </span><span class="nt">repeat_times</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span><span class="w">  </span><span class="c1"># actor_rollout_ref.rollout.n=8</span>
<span class="w">  </span><span class="nt">optimizer</span><span class="p">:</span>
<span class="w">    </span><span class="nt">lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1e-6</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.optim.lr</span>
<span class="w">  </span><span class="nt">advantage_fn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grpo</span><span class="w">  </span><span class="c1"># algorithm.adv_estimator=grpo</span>
<span class="w">  </span><span class="nt">kl_penalty_fn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span><span class="w">  </span><span class="c1"># algorithm.use_kl_in_reward=False</span>
<span class="w">  </span><span class="nt">kl_loss_fn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">low_var_kl</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.kl_loss_type=low_var_kl</span>
<span class="w">  </span><span class="nt">kl_loss_fn_args</span><span class="p">:</span>
<span class="w">    </span><span class="nt">kl_coef</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.001</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.kl_loss_coef</span>
<span class="w">  </span><span class="nt">entropy_loss_fn_args</span><span class="p">:</span>
<span class="w">    </span><span class="nt">entropy_coef</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.entropy_coeff=0</span>

<span class="nt">model</span><span class="p">:</span>
<span class="w">  </span><span class="nt">model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deepseek-ai/deepseek-llm-7b-chat</span><span class="w">  </span><span class="c1"># actor_rollout_ref.model.path</span>
<span class="w">  </span><span class="nt">max_prompt_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span><span class="w">  </span><span class="c1"># data.max_prompt_length</span>
<span class="w">  </span><span class="nt">max_response_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span><span class="w">  </span><span class="c1"># data.max_response_length</span>
<span class="w">  </span><span class="nt">enable_prompt_truncation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># data.filter_overlong_prompts=True</span>

<span class="nt">cluster</span><span class="p">:</span>
<span class="w">  </span><span class="nt">node_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># trainer.nnodes</span>
<span class="w">  </span><span class="nt">gpu_per_node</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span><span class="w">  </span><span class="c1"># trainer.n_gpus_per_node</span>

<span class="nt">buffer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">total_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w">  </span><span class="c1"># trainer.total_epochs</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.ppo_mini_batch_size</span>
<span class="w">  </span><span class="nt">train_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2048</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.ppo_mini_batch_size * actor_rollout_ref.rollout.n=256*8=2048</span>
<span class="w">  </span><span class="nt">explorer_input</span><span class="p">:</span>
<span class="w">    </span><span class="nt">tasksets</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gsm8k</span>
<span class="w">        </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:HOME}/data/gsm8k</span>
<span class="w">        </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prompt</span><span class="w">  </span><span class="c1"># Check the dataset format</span>
<span class="w">          </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">answer</span><span class="w">  </span><span class="c1"># Check the dataset format</span>
<span class="w">    </span><span class="nt">eval_tasksets</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gsm8k_eval</span>
<span class="w">        </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:HOME}/data/gsm8k</span>
<span class="w">        </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prompt</span><span class="w">  </span><span class="c1"># Check the dataset format</span>
<span class="w">          </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">answer</span><span class="w">  </span><span class="c1"># Check the dataset format</span>

<span class="nt">explorer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">eval_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w">  </span><span class="c1"># trainer.test_freq</span>
<span class="w">  </span><span class="nt">rollout_model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">engine_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">tensor_parallel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">  </span><span class="c1"># actor_rollout_ref.rollout.tensor_model_parallel_size</span>
<span class="w">    </span><span class="nt">gpu_memory_utilization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.6</span><span class="w">  </span><span class="c1"># actor_rollout_ref.rollout.gpu_memory_utilization</span>

<span class="nt">synchronizer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">sync_style</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fixed</span>
<span class="w">  </span><span class="nt">sync_offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">sync_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w">  </span><span class="c1"># data.train_batch_size / actor_rollout_ref.actor.ppo_mini_batch_size in veRL</span>
<span class="w">  </span><span class="nt">sync_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1200</span>

<span class="nt">trainer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">save_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w">  </span><span class="c1"># trainer.save_freq</span>
<span class="w">  </span><span class="nt">use_dynamic_bsz</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.use_dynamic_bsz=True</span>
<span class="w">  </span><span class="nt">max_token_len_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24000</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.ppo_max_token_len_per_gpu</span>
<span class="w">  </span><span class="nt">trainer_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">actor_rollout_ref</span><span class="p">:</span>
<span class="w">      </span><span class="nt">model</span><span class="p">:</span>
<span class="w">        </span><span class="nt">use_remove_padding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># actor_rollout_ref.model.use_remove_padding=True</span>
<span class="w">        </span><span class="nt">enable_gradient_checkpointing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># actor_rollout_ref.model.enable_gradient_checkpointing=True</span>
<span class="w">      </span><span class="nt">actor</span><span class="p">:</span>
<span class="w">        </span><span class="nt">fsdp_config</span><span class="p">:</span>
<span class="w">          </span><span class="nt">param_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.fsdp_config.param_offload=False</span>
<span class="w">          </span><span class="nt">optimizer_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># actor_rollout_ref.actor.fsdp_config.optimizer_offload=False</span>
<span class="w">      </span><span class="nt">ref</span><span class="p">:</span>
<span class="w">        </span><span class="nt">fsdp_config</span><span class="p">:</span>
<span class="w">          </span><span class="nt">param_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># actor_rollout_ref.ref.fsdp_config.param_offload=True</span>
<span class="w">    </span><span class="nt">trainer</span><span class="p">:</span>
<span class="w">      </span><span class="nt">critic_warmup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">  </span><span class="c1"># trainer.critic_warmup=0</span>

<span class="nt">monitor</span><span class="p">:</span>
<span class="w">  </span><span class="nt">monitor_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wandb</span><span class="w">  </span><span class="c1"># trainer.logger=&#39;[&quot;console&quot;,&quot;wandb&quot;]&#39; - wandb is extracted, console is default</span>
</pre></div>
</div>
<p>The command to run this example is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>trinity<span class="w"> </span>run<span class="w"> </span>--config<span class="w"> </span>grpo_example.yaml
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="synchronizer.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Synchronizer in Trinity-RFT</p>
      </div>
    </a>
    <a class="right-next"
       href="example_reasoning_basic.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Quick Start</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-mapping">Parameter Mapping</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algorithm">Algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#actor-rollout-and-critic">Actor, Rollout, and Critic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reward-model">Reward Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trainer">Trainer</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gpu-resource-allocation">GPU Resource Allocation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics-mapping">Metrics Mapping</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-we-see-two-runs-for-each-experiment">Why do we see two runs for each experiment?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-are-some-metrics-different-from-verl">Why are some metrics different from veRL?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-ppo-training">Example: PPO Training</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-grpo-training">Example: GRPO Training</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Trinity-RFT Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2025, Trinity-RFT Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>