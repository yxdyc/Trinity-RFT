
<!DOCTYPE html>


<html lang="zh-CN" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>å‚æ•°é…ç½®æŒ‡å— &#8212; Trinity-RFT 0.4.0 æ–‡æ¡£</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=0a12e38e"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial/trinity_configs';</script>
    <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
    <link rel="search" title="æœç´¢" href="../search.html" />
    <link rel="next" title="GPU èµ„æºç›¸å…³é…ç½®æŒ‡å—" href="trinity_gpu_configs.html" />
    <link rel="prev" title="ğŸ§ª å®éªŒæ€§åŠŸèƒ½ï¼šä»»åŠ¡é€‰æ‹©å™¨" href="develop_selector.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="zh-CN"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="Trinity-RFT 0.4.0 æ–‡æ¡£ - Home"/>
    <script>document.write(`<img src="../_static/logo.svg" class="logo__image only-dark" alt="Trinity-RFT 0.4.0 æ–‡æ¡£ - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">
<nav class="bd-links bd-docs-nav">
    <div class="bd-toc-item navbar-nav">
        <ul class="nav bd-sidenav">
      <li class="toctree-l1 has-children">
        <details>
          <summary>
            <p class="caption" aria-level="2" role="heading" style="text-align: center;">
              <span class="fa fa-book"></span>
             <b>latest</b>
            </p>
          </summary>
          <ul>
            <li class="toctree-l2 current "><a class="reference" href="trinity_configs.html">latest</a></li>
          </ul>
        </details>
      </li>
    </ul>
    </div>
</nav>
</div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="æœç´¢" aria-label="æœç´¢" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">æœç´¢</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">æ•™ç¨‹</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="trinity_installation.html">å®‰è£…æŒ‡å—</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop_overview.html">å¼€å‘è€…æŒ‡å—</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop_workflow.html">Workflow å¼€å‘æŒ‡å—</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop_algorithm.html">Algorithm å¼€å‘æŒ‡å—</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_mix_algo.html">Algorithm è¿›é˜¶å¼€å‘</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop_operator.html">Operator å¼€å‘æŒ‡å—</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop_selector.html">ğŸ§ª å®éªŒæ€§åŠŸèƒ½ï¼šä»»åŠ¡é€‰æ‹©å™¨</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">å‚æ•°é…ç½®æŒ‡å—</a></li>
<li class="toctree-l1"><a class="reference internal" href="trinity_gpu_configs.html">GPU èµ„æºç›¸å…³é…ç½®æŒ‡å—</a></li>
<li class="toctree-l1"><a class="reference internal" href="synchronizer.html">Synchronizer ä»‹ç»</a></li>
<li class="toctree-l1"><a class="reference internal" href="align_with_verl.html">ä¸ veRL å¯¹é½è®­ç»ƒé…ç½®</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">æ ·ä¾‹</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="example_reasoning_basic.html">å¿«é€Ÿä¸Šæ‰‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_reasoning_advanced.html">Off-Policy RFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_async_mode.html">å¼‚æ­¥ RFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_multi_turn.html">å¤šè½®å¯¹è¯æ‹¼æ¥ä»»åŠ¡</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_step_wise.html">é€šç”¨å¤šè½® RFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_react.html">ReAct Agent è®­ç»ƒ</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_search_email.html">é‚®ä»¶æœç´¢ä¾‹å­</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_dpo.html">ç¦»çº¿ DPO å’Œ SFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_tinker_backend.html">Tinker åç«¯</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_megatron.html">Megatron-LM æ”¯æŒ</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_data_functionalities.html">æ•°æ®å¤„ç†</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_dataset_perspective.html">æ ·ä¾‹æ€»è§ˆ</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">å¸¸è§é—®é¢˜</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="faq.html">å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../api_reference.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.buffer.html">trinity.buffer package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.operators.html">trinity.buffer.operators package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.operators.filters.html">trinity.buffer.operators.filters package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.operators.mappers.html">trinity.buffer.operators.mappers package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.operators.data_juicer_operator.html">trinity.buffer.operators.data_juicer_operator module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.operators.experience_operator.html">trinity.buffer.operators.experience_operator module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.pipelines.html">trinity.buffer.pipelines package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.pipelines.experience_pipeline.html">trinity.buffer.pipelines.experience_pipeline module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.pipelines.task_pipeline.html">trinity.buffer.pipelines.task_pipeline module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.reader.html">trinity.buffer.reader package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.reader.file_reader.html">trinity.buffer.reader.file_reader module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.reader.queue_reader.html">trinity.buffer.reader.queue_reader module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.reader.sql_reader.html">trinity.buffer.reader.sql_reader module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.schema.html">trinity.buffer.schema package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.schema.formatter.html">trinity.buffer.schema.formatter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.schema.sql_schema.html">trinity.buffer.schema.sql_schema module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.selector.html">trinity.buffer.selector package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.selector.difficulty_estimator.html">trinity.buffer.selector.difficulty_estimator module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.selector.selector.html">trinity.buffer.selector.selector module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.storage.html">trinity.buffer.storage package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.storage.file.html">trinity.buffer.storage.file module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.storage.queue.html">trinity.buffer.storage.queue module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.storage.sql.html">trinity.buffer.storage.sql module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.buffer.writer.html">trinity.buffer.writer package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.writer.file_writer.html">trinity.buffer.writer.file_writer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.writer.queue_writer.html">trinity.buffer.writer.queue_writer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.buffer.writer.sql_writer.html">trinity.buffer.writer.sql_writer module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.buffer.html">trinity.buffer.buffer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.buffer_reader.html">trinity.buffer.buffer_reader module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.buffer_writer.html">trinity.buffer.buffer_writer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.task_scheduler.html">trinity.buffer.task_scheduler module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.utils.html">trinity.buffer.utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.buffer.viewer.html">trinity.buffer.viewer module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.explorer.html">trinity.explorer package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.explorer.proxy.html">trinity.explorer.proxy package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.explorer.proxy.app.html">trinity.explorer.proxy.app module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.explorer.proxy.client.html">trinity.explorer.proxy.client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.explorer.proxy.recorder.html">trinity.explorer.proxy.recorder module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.explorer.proxy.service.html">trinity.explorer.proxy.service module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.explorer.explorer.html">trinity.explorer.explorer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.explorer.scheduler.html">trinity.explorer.scheduler module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.explorer.workflow_runner.html">trinity.explorer.workflow_runner module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.trainer.html">trinity.trainer package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.trainer.tinker.html">trinity.trainer.tinker package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.tinker.utils.html">trinity.trainer.tinker.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.trainer.verl.html">trinity.trainer.verl package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.dp_actor.html">trinity.trainer.verl.dp_actor module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.fsdp_checkpoint_manager.html">trinity.trainer.verl.fsdp_checkpoint_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.fsdp_workers.html">trinity.trainer.verl.fsdp_workers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.megatron_actor.html">trinity.trainer.verl.megatron_actor module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.megatron_checkpoint_manager.html">trinity.trainer.verl.megatron_checkpoint_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.megatron_workers.html">trinity.trainer.verl.megatron_workers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.trainer.verl.utils.html">trinity.trainer.verl.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.trainer.tinker_trainer.html">trinity.trainer.tinker_trainer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.trainer.trainer.html">trinity.trainer.trainer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.trainer.verl_trainer.html">trinity.trainer.verl_trainer module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.html">trinity.algorithm package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.html">trinity.algorithm.advantage_fn package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.advantage_fn.html">trinity.algorithm.advantage_fn.advantage_fn module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.asymre_advantage.html">trinity.algorithm.advantage_fn.asymre_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.grpo_advantage.html">trinity.algorithm.advantage_fn.grpo_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.multi_step_grpo_advantage.html">trinity.algorithm.advantage_fn.multi_step_grpo_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.on_policy_distill_advantage.html">trinity.algorithm.advantage_fn.on_policy_distill_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.opmd_advantage.html">trinity.algorithm.advantage_fn.opmd_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.ppo_advantage.html">trinity.algorithm.advantage_fn.ppo_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.rec_advantage.html">trinity.algorithm.advantage_fn.rec_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.reinforce_advantage.html">trinity.algorithm.advantage_fn.reinforce_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.reinforce_plus_plus_advantage.html">trinity.algorithm.advantage_fn.reinforce_plus_plus_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.remax_advantage.html">trinity.algorithm.advantage_fn.remax_advantage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.advantage_fn.rloo_advantage.html">trinity.algorithm.advantage_fn.rloo_advantage module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.entropy_loss_fn.html">trinity.algorithm.entropy_loss_fn package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.entropy_loss_fn.entropy_loss_fn.html">trinity.algorithm.entropy_loss_fn.entropy_loss_fn module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.kl_fn.html">trinity.algorithm.kl_fn package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.kl_fn.kl_fn.html">trinity.algorithm.kl_fn.kl_fn module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.html">trinity.algorithm.policy_loss_fn package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.chord_policy_loss.html">trinity.algorithm.policy_loss_fn.chord_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.cispo_policy_loss.html">trinity.algorithm.policy_loss_fn.cispo_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.dpo_loss.html">trinity.algorithm.policy_loss_fn.dpo_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.gspo_policy_loss.html">trinity.algorithm.policy_loss_fn.gspo_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.importance_sampling_policy_loss.html">trinity.algorithm.policy_loss_fn.importance_sampling_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.mix_policy_loss.html">trinity.algorithm.policy_loss_fn.mix_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.opmd_policy_loss.html">trinity.algorithm.policy_loss_fn.opmd_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.policy_loss_fn.html">trinity.algorithm.policy_loss_fn.policy_loss_fn module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.ppo_policy_loss.html">trinity.algorithm.policy_loss_fn.ppo_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.rec_policy_loss.html">trinity.algorithm.policy_loss_fn.rec_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.sapo_policy_loss.html">trinity.algorithm.policy_loss_fn.sapo_policy_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.sft_loss.html">trinity.algorithm.policy_loss_fn.sft_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.sppo_loss_fn.html">trinity.algorithm.policy_loss_fn.sppo_loss_fn module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.policy_loss_fn.topr_policy_loss.html">trinity.algorithm.policy_loss_fn.topr_policy_loss module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.algorithm.sample_strategy.html">trinity.algorithm.sample_strategy package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.sample_strategy.mix_sample_strategy.html">trinity.algorithm.sample_strategy.mix_sample_strategy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.sample_strategy.sample_strategy.html">trinity.algorithm.sample_strategy.sample_strategy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.algorithm.sample_strategy.utils.html">trinity.algorithm.sample_strategy.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.algorithm.algorithm.html">trinity.algorithm.algorithm module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.algorithm.key_mapper.html">trinity.algorithm.key_mapper module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.algorithm.utils.html">trinity.algorithm.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.manager.html">trinity.manager package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.manager.config_registry.html">trinity.manager.config_registry package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.algorithm_config_manager.html">trinity.manager.config_registry.algorithm_config_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.buffer_config_manager.html">trinity.manager.config_registry.buffer_config_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.config_registry.html">trinity.manager.config_registry.config_registry module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.explorer_config_manager.html">trinity.manager.config_registry.explorer_config_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.model_config_manager.html">trinity.manager.config_registry.model_config_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.manager.config_registry.trainer_config_manager.html">trinity.manager.config_registry.trainer_config_manager module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.manager.config_manager.html">trinity.manager.config_manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.manager.state_manager.html">trinity.manager.state_manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.manager.synchronizer.html">trinity.manager.synchronizer module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.common.html">trinity.common package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.common.models.html">trinity.common.models package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.vllm_patch.html">trinity.common.models.vllm_patch package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.mm_utils.html">trinity.common.models.mm_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.model.html">trinity.common.models.model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.tinker_model.html">trinity.common.models.tinker_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.utils.html">trinity.common.models.utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.vllm_model.html">trinity.common.models.vllm_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.models.vllm_worker.html">trinity.common.models.vllm_worker module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.common.rewards.html">trinity.common.rewards package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.accuracy_reward.html">trinity.common.rewards.accuracy_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.agents_reward.html">trinity.common.rewards.agents_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.countdown_reward.html">trinity.common.rewards.countdown_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.dapo_reward.html">trinity.common.rewards.dapo_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.eval_utils.html">trinity.common.rewards.eval_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.format_reward.html">trinity.common.rewards.format_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.human_reward.html">trinity.common.rewards.human_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.math_reward.html">trinity.common.rewards.math_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.naive_dapo_score.html">trinity.common.rewards.naive_dapo_score module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.qwen25_eval.html">trinity.common.rewards.qwen25_eval module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.reward_fn.html">trinity.common.rewards.reward_fn module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.tool_reward.html">trinity.common.rewards.tool_reward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.rewards.utils.html">trinity.common.rewards.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../build_api/trinity.common.workflows.html">trinity.common.workflows package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.agentscope.html">trinity.common.workflows.agentscope package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.agentscope_workflow.html">trinity.common.workflows.agentscope_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.customized_math_workflows.html">trinity.common.workflows.customized_math_workflows module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.customized_toolcall_workflows.html">trinity.common.workflows.customized_toolcall_workflows module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.eval_workflow.html">trinity.common.workflows.eval_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.math_rm_workflow.html">trinity.common.workflows.math_rm_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.math_ruler_workflow.html">trinity.common.workflows.math_ruler_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.math_trainable_ruler_workflow.html">trinity.common.workflows.math_trainable_ruler_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.on_policy_distill_workflow.html">trinity.common.workflows.on_policy_distill_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.rubric_judge_workflow.html">trinity.common.workflows.rubric_judge_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.simple_mm_workflow.html">trinity.common.workflows.simple_mm_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.step_wise_workflow.html">trinity.common.workflows.step_wise_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build_api/trinity.common.workflows.workflow.html">trinity.common.workflows.workflow module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.common.config.html">trinity.common.config module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.common.constants.html">trinity.common.constants module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.common.experience.html">trinity.common.experience module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.common.verl_config.html">trinity.common.verl_config module</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../build_api/trinity.utils.html">trinity.utils package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.annotations.html">trinity.utils.annotations module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.distributed.html">trinity.utils.distributed module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.dlc_utils.html">trinity.utils.dlc_utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.log.html">trinity.utils.log module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.lora_utils.html">trinity.utils.lora_utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.monitor.html">trinity.utils.monitor module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.plugin_loader.html">trinity.utils.plugin_loader module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.registry.html">trinity.utils.registry module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_api/trinity.utils.timer.html">trinity.utils.timer module</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">
<div class="header-extra-switchers" style="display:inline-flex; gap:.25rem; margin-left:.5rem; align-items:center;">
  <button id="lang-toggle-btn" class="btn btn-sm btn-outline-secondary" title="">
  <span id="lang-toggle-label"></span>
</button>
<script>
(function () {
  const btn = document.getElementById('lang-toggle-btn');
  const lab = document.getElementById('lang-toggle-label');
  if (!btn || !lab) return;

  const m = location.pathname.match(/^(.*\/)(en|zh)(\/.*)$/);

  const cur = m ? m[2] : 'en';
  if (cur === 'en') {
    lab.textContent = 'ä¸­';
    btn.title = 'åˆ‡æ¢åˆ°ä¸­æ–‡';
  } else {
    lab.textContent = 'EN';
    btn.title = 'Switch to English';
  }

  const targetHref = (function () {
    if (!m) return location.href;
    const other = cur === 'en' ? 'zh' : 'en';
    const suffix = m[3] || '/';
    return m[1] + other + suffix + location.search + location.hash;
  })();

  btn.addEventListener('click', function () {
    location.href = targetHref;
  });
})();
</script>
</div>



<div class="article-header-buttons">


<a href="https://github.com/modelscope/Trinity-RFT" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="æºç åº“"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="ä¸‹è½½æ­¤é¡µé¢">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tutorial/trinity_configs.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="ä¸‹è½½æºæ–‡ä»¶"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="åˆ—å°æˆ PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="å…¨å±æ¨¡å¼"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="æœç´¢" aria-label="æœç´¢" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>å‚æ•°é…ç½®æŒ‡å—</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> ç›®å½• </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">æ¦‚è¿°</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">å…¨å±€é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">ç®—æ³•é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">ç›‘æ§é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model">Model é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cluster">Cluster é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#buffer">Buffer é…ç½®</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explorer">Explorer è¾“å…¥é…ç½®</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trainer">Trainer è¾“å…¥é…ç½®</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Explorer é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronizer">Synchronizer é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Trainer é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#service">Service é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataprocessor">DataProcessor é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#log">Log é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stage">Stage é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verl-trainer">veRL Trainer é…ç½®ï¼ˆé«˜çº§ï¼‰</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">å›¾å½¢åŒ–é…ç½®ç”Ÿæˆå™¨ï¼ˆé«˜çº§ï¼‰</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#streamlit">æ­¥éª¤ 0ï¼šäº†è§£ Streamlit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">æ­¥éª¤ 1ï¼šå®ç°æ–°é…ç½®é¡¹</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#config-manager-py">æ­¥éª¤ 2ï¼šå°†æ–°å‚æ•°é›†æˆåˆ° <code class="docutils literal notranslate"><span class="pre">config_manager.py</span></code></a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="configuration-guide">
<span id="id1"></span><h1>å‚æ•°é…ç½®æŒ‡å—<a class="headerlink" href="#configuration-guide" title="Link to this heading">#</a></h1>
<p>æœ¬èŠ‚è¯¦ç»†æè¿°äº† <strong>Trinity-RFT</strong> ä¸­ä½¿ç”¨çš„å‚æ•°ã€‚</p>
<section id="id2">
<h2>æ¦‚è¿°<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p><strong>Trinity-RFT</strong> çš„é…ç½®é€šè¿‡ä¸€ä¸ª <code class="docutils literal notranslate"><span class="pre">YAML</span></code> æ–‡ä»¶å®šä¹‰ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ¨¡å—åˆ’åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºç¡€é…ç½®æ–‡ä»¶çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Trinity-RFT</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">both</span>
<span class="nt">checkpoint_root_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:TRINITY_CHECKPOINT_ROOT_DIR,./checkpoints}</span>
<span class="nt">continue_from_checkpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">algorithm</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ç®—æ³•ç›¸å…³å‚æ•°</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">model</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># æ¨¡å‹ç›¸å…³é…ç½®</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">cluster</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># é›†ç¾¤èŠ‚ç‚¹å’Œ GPU è®¾ç½®</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">buffer</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># æ•°æ®ç›¸å…³é…ç½®</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">explorer</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># explorer ç›¸å…³è®¾ç½®ï¼ˆrollout æ¨¡å‹ã€workflow runnersï¼‰</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">trainer</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># trainer ç‰¹å®šå‚æ•°</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">synchronizer</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># æ¨¡å‹æƒé‡åŒæ­¥è®¾ç½®</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">monitor</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ç›‘æ§é…ç½®ï¼ˆä¾‹å¦‚ WandBã€TensorBoard æˆ– MLFlowï¼‰</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">service</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ä½¿ç”¨çš„æœåŠ¡</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">data_processor</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># æ•°æ®é¢„å¤„ç†è®¾ç½®</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">log</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Ray actor æ—¥å¿—</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>

<span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># å¤šé˜¶æ®µè®­ç»ƒ</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>æ¯ä¸ªéƒ¨åˆ†å°†åœ¨ä¸‹æ–‡è¯¦ç»†è¯´æ˜ã€‚å…³äºæ­¤å¤„æœªæ¶µç›–çš„å…·ä½“å‚æ•°çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è€ƒ<a class="reference external" href="https://github.com/modelscope/Trinity-RFT/blob/main/trinity/common/config.py">æºç </a>ã€‚</p>
<div class="admonition tip">
<p class="admonition-title">å°æŠ€å·§</p>
<p>Trinity-RFT ä½¿ç”¨<a class="reference external" href="https://omegaconf.readthedocs.io/en/latest/">OmegaConf</a> æ¥åŠ è½½ YAML é…ç½®æ–‡ä»¶ã€‚
å®ƒæ”¯æŒä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œå¦‚<a class="reference external" href="https://omegaconf.readthedocs.io/en/latest/usage.html#variable-interpolation">å˜é‡æ’å€¼</a>å’Œ<a class="reference external" href="https://omegaconf.readthedocs.io/en/latest/custom_resolvers.html#oc-env">ç¯å¢ƒå˜é‡æ›¿æ¢</a>ã€‚
ç”¨æˆ·å¯åˆ©ç”¨è¿™äº›ç‰¹æ€§ç®€åŒ–é…ç½®ã€‚</p>
</div>
</section>
<hr class="docutils" />
<section id="id3">
<h2>å…¨å±€é…ç½®<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>è¿™äº›æ˜¯é€‚ç”¨äºæ•´ä¸ªå®éªŒçš„ä¸€èˆ¬æ€§è®¾ç½®ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Trinity-RFT</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">both</span>
<span class="nt">checkpoint_root_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:TRINITY_CHECKPOINT_ROOT_DIR,./checkpoints}</span><span class="w">   </span><span class="c1"># TRINITY_CHECKPOINT_ROOT_DIR æ˜¯é¢„å…ˆè®¾ç½®çš„ç¯å¢ƒå˜é‡</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">project</span></code>: é¡¹ç›®åç§°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: å½“å‰å®éªŒçš„åç§°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>: Trinity-RFT çš„è¿è¡Œæ¨¡å¼ã€‚é€‰é¡¹åŒ…æ‹¬ï¼š</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">both</span></code>: åŒæ—¶å¯åŠ¨ trainer å’Œ explorerï¼ˆé»˜è®¤ï¼‰ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train</span></code>: ä»…å¯åŠ¨ trainerã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">explore</span></code>: ä»…å¯åŠ¨ explorerã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bench</span></code>: ç”¨äº benchmark æµ‹è¯•ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">checkpoint_root_dir</span></code>: æ‰€æœ‰æ£€æŸ¥ç‚¹å’Œæ—¥å¿—çš„æ ¹ç›®å½•ã€‚è¯¥å®éªŒçš„æ£€æŸ¥ç‚¹å°†å­˜å‚¨åœ¨ <code class="docutils literal notranslate"><span class="pre">&lt;checkpoint_root_dir&gt;/&lt;project&gt;/&lt;name&gt;/</span></code> è·¯å¾„ä¸‹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">continue_from_checkpoint</span></code>: è‹¥è®¾ç½®ä¸º <code class="docutils literal notranslate"><span class="pre">true</span></code>ï¼Œå®éªŒå°†ä»æ£€æŸ¥ç‚¹è·¯å¾„ä¸­çš„æœ€æ–°æ£€æŸ¥ç‚¹ç»§ç»­ï¼›å¦åˆ™ï¼Œä¼šå°†å½“å‰å®éªŒé‡å‘½åä¸º <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;_&lt;timestamp&gt;</span></code> å¹¶å¯åŠ¨æ–°å®éªŒã€‚ç”±äºæˆ‘ä»¬çš„åˆ†ç¦»å¼è®¾è®¡ï¼Œä»æ£€æŸ¥ç‚¹æ¢å¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªèƒ½ä¿è¯Trainerçš„æ¨¡å‹å‚æ•°ä»¥åŠå…¶ä½¿ç”¨çš„å¯é€‰ç¼“å†²åŒºï¼ˆ<code class="docutils literal notranslate"><span class="pre">auxiliary_buffers</span></code>ï¼‰å¯ä»¥æ¢å¤åˆ°æœ€æ–°æ£€æŸ¥ç‚¹çš„çŠ¶æ€ï¼Œè€ŒExplorerå’ŒExperience Bufferä¸èƒ½ä¿è¯æ¢å¤åˆ°åŒä¸€æ—¶ç‚¹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ray_namespace</span></code>: å½“å‰å®éªŒä¸­å¯åŠ¨æ¨¡å—çš„å‘½åç©ºé—´ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">&lt;project&gt;/&lt;name&gt;</span></code>ã€‚</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="id4">
<h2>ç®—æ³•é…ç½®<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>æŒ‡å®š RFT ç®—æ³•ç±»å‹åŠå…¶ç›¸å…³è¶…å‚æ•°ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">algorithm</span><span class="p">:</span>
<span class="w">  </span><span class="nt">algorithm_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grpo</span>
<span class="w">  </span><span class="nt">repeat_times</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">  </span><span class="nt">optimizer</span><span class="p">:</span>
<span class="w">    </span><span class="nt">lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1e-6</span>
<span class="w">    </span><span class="nt">warmup_style</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">constant</span>
<span class="w">  </span><span class="c1"># ä»¥ä¸‹å‚æ•°ä¸ºå¯é€‰</span>
<span class="w">  </span><span class="c1"># è‹¥æœªæŒ‡å®šï¼Œå°†æ ¹æ® `algorithm_type` è‡ªåŠ¨è®¾ç½®</span>
<span class="w">  </span><span class="nt">sample_strategy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span>
<span class="w">  </span><span class="nt">advantage_fn</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ppo&quot;</span>
<span class="w">  </span><span class="nt">kl_penalty_fn</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;none&quot;</span>
<span class="w">  </span><span class="nt">kl_loss_fn</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;k2&quot;</span>
<span class="w">  </span><span class="nt">entropy_loss_fn</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">algorithm_type</span></code>: å¼ºåŒ–å­¦ä¹ ç®—æ³•ç±»å‹ã€‚æ”¯æŒç±»å‹ï¼š<code class="docutils literal notranslate"><span class="pre">ppo</span></code>ã€<code class="docutils literal notranslate"><span class="pre">grpo</span></code>ã€<code class="docutils literal notranslate"><span class="pre">opmd</span></code>ã€<code class="docutils literal notranslate"><span class="pre">dpo</span></code>ã€<code class="docutils literal notranslate"><span class="pre">sft</span></code>ã€<code class="docutils literal notranslate"><span class="pre">mix</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">repeat_times</span></code>: æ¯ä¸ªä»»åŠ¡é‡å¤çš„æ¬¡æ•°ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">1</span></code>ã€‚åœ¨ <code class="docutils literal notranslate"><span class="pre">dpo</span></code> ä¸­è‡ªåŠ¨è®¾ä¸º <code class="docutils literal notranslate"><span class="pre">2</span></code>ã€‚æŸäº›ç®—æ³•å¦‚ GRPO å’Œ OPMD è¦æ±‚ <code class="docutils literal notranslate"><span class="pre">repeat_times</span></code> &gt; 1ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optimizer</span></code>: Actor ä¼˜åŒ–å™¨çš„å‚æ•°ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lr</span></code>: ä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">warmup_style</span></code>: å­¦ä¹ ç‡çš„é¢„çƒ­ç­–ç•¥ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sample_strategy</span></code>: ä» experience buffer åŠ è½½ experience æ—¶ä½¿ç”¨çš„é‡‡æ ·ç­–ç•¥ã€‚æ”¯æŒç±»å‹ï¼š<code class="docutils literal notranslate"><span class="pre">default</span></code>ã€<code class="docutils literal notranslate"><span class="pre">staleness_control</span></code>ã€<code class="docutils literal notranslate"><span class="pre">mix</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">advantage_fn</span></code>: ç”¨äºè®¡ç®—ä¼˜åŠ¿å€¼çš„å‡½æ•°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kl_penalty_fn</span></code>: ç”¨äºåœ¨å¥–åŠ±ä¸­è®¡ç®— KL æƒ©ç½šçš„å‡½æ•°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kl_loss_fn</span></code>: ç”¨äºè®¡ç®— KL æŸå¤±çš„å‡½æ•°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">entropy_loss_fn</span></code>: ç”¨äºè®¡ç®—ç†µæŸå¤±çš„å‡½æ•°ã€‚</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="id5">
<h2>ç›‘æ§é…ç½®<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>ç”¨äºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è®°å½•æŒ‡æ ‡ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">monitor</span><span class="p">:</span>
<span class="w">  </span><span class="nt">monitor_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wandb</span>
<span class="w">  </span><span class="nt">monitor_args</span><span class="p">:</span>
<span class="w">    </span><span class="nt">base_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8080</span>
<span class="w">    </span><span class="nt">api_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your_api_key</span>
<span class="w">  </span><span class="nt">enable_ray_timeline</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">monitor_type</span></code>: ç›‘æ§ç³»ç»Ÿç±»å‹ã€‚é€‰é¡¹ï¼š</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">wandb</span></code>: è®°å½•åˆ° <a class="reference external" href="https://docs.wandb.ai/quickstart/">Weights &amp; Biases</a>ã€‚éœ€è¦ç™»å½•å¹¶è®¾ç½® <code class="docutils literal notranslate"><span class="pre">WANDB_API_KEY</span></code>ã€‚é¡¹ç›®å’Œè¿è¡Œåç§°ä¸å…¨å±€é…ç½®ä¸­çš„ <code class="docutils literal notranslate"><span class="pre">project</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">name</span></code> å­—æ®µä¸€è‡´ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tensorboard</span></code>: è®°å½•åˆ° <a class="reference external" href="https://www.tensorflow.org/tensorboard">TensorBoard</a>ã€‚æ–‡ä»¶ä¿å­˜åœ¨ <code class="docutils literal notranslate"><span class="pre">&lt;checkpoint_root_dir&gt;/&lt;project&gt;/&lt;name&gt;/monitor/tensorboard</span></code> ä¸‹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mlflow</span></code>: è®°å½•åˆ° <a class="reference external" href="https://mlflow.org/">MLFlow</a>ã€‚å¦‚æœè®¾ç½®äº† <a class="reference external" href="https://mlflow.org/docs/latest/ml/auth/">MLFlow è®¤è¯</a>ï¼Œè¯·åœ¨è¿è¡Œå‰å°† <code class="docutils literal notranslate"><span class="pre">MLFLOW_TRACKING_USERNAME</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">MLFLOW_TRACKING_PASSWORD</span></code> è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">monitor_args</span></code>: åˆå§‹åŒ–ç›‘æ§å™¨çš„å‚æ•°å­—å…¸ã€‚</p>
<ul>
<li><p>å¯¹äº <code class="docutils literal notranslate"><span class="pre">wandb</span></code>ï¼š</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">base_url</span></code>: è‹¥è®¾ç½®ï¼Œå°†è¦†ç›– <code class="docutils literal notranslate"><span class="pre">WANDB_BASE_URL</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">api_key</span></code>: è‹¥è®¾ç½®ï¼Œå°†è¦†ç›– <code class="docutils literal notranslate"><span class="pre">WANDB_API_KEY</span></code>ã€‚</p></li>
</ul>
</li>
<li><p>å¯¹äº <code class="docutils literal notranslate"><span class="pre">mlflow</span></code>ï¼š</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">uri</span></code>: MLFlow å®ä¾‹çš„ URIã€‚å¼ºçƒˆå»ºè®®è®¾ç½®ï¼›é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">http://localhost:5000</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">username</span></code>: è‹¥è®¾ç½®ï¼Œå°†è¦†ç›– <code class="docutils literal notranslate"><span class="pre">MLFLOW_TRACKING_USERNAME</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">password</span></code>: è‹¥è®¾ç½®ï¼Œå°†è¦†ç›– <code class="docutils literal notranslate"><span class="pre">MLFLOW_TRACKING_PASSWORD</span></code>ã€‚</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">enable_ray_timeline</span></code>: è‹¥ä¸º <code class="docutils literal notranslate"><span class="pre">True</span></code>ï¼Œå°†å¯¼å‡ºä¸€ä¸ª <code class="docutils literal notranslate"><span class="pre">timeline.json</span></code> æ–‡ä»¶åˆ° <code class="docutils literal notranslate"><span class="pre">&lt;checkpoint_root_dir&gt;/&lt;project&gt;/&lt;name&gt;/monitor</span></code>ã€‚å¯åœ¨ Chrome æµè§ˆå™¨ä¸­è®¿é—® <a class="reference internal" href="#chrome://tracing"><span class="xref myst">chrome://tracing</span></a> æŸ¥çœ‹ã€‚</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="model">
<h2>Model é…ç½®<a class="headerlink" href="#model" title="Link to this heading">#</a></h2>
<p>å®šä¹‰æ¨¡å‹è·¯å¾„å’Œ token é™åˆ¶ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">model</span><span class="p">:</span>
<span class="w">  </span><span class="nt">model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:MODEL_PATH}</span><span class="w">  </span><span class="c1"># MODEL_PATH æ˜¯é¢„å…ˆè®¾ç½®çš„ç¯å¢ƒå˜é‡</span>
<span class="w">  </span><span class="nt">critic_model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${model.model_path}</span><span class="w">  </span><span class="c1"># ä½¿ç”¨ model.model_path çš„å€¼</span>
<span class="w">  </span><span class="nt">custom_chat_template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">chat_template_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">max_model_len</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20480</span>
<span class="w">  </span><span class="nt">max_prompt_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4096</span>
<span class="w">  </span><span class="nt">max_response_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16384</span>
<span class="w">  </span><span class="nt">min_response_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">enable_prompt_truncation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">repetition_penalty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">  </span><span class="nt">lora_configs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">rope_scaling</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">rope_theta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">tinker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">rank</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="w">    </span><span class="nt">seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">train_mlp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">train_attn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">train_unembed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_path</span></code>: è¢«è®­ç»ƒæ¨¡å‹çš„è·¯å¾„ã€‚å¦‚æœå¯ç”¨äº†<code class="docutils literal notranslate"><span class="pre">tinker</span></code>ï¼Œåˆ™è¯¥è·¯å¾„ä¸ºæœ¬åœ° tokenizer çš„è·¯å¾„ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic_model_path</span></code>: å¯é€‰çš„ç‹¬ç«‹ critic æ¨¡å‹è·¯å¾„ã€‚è‹¥ä¸ºç©ºï¼Œåˆ™é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">model_path</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">custom_chat_template</span></code>: å¯é€‰çš„è‡ªå®šä¹‰ chat template å­—ç¬¦ä¸²æ ¼å¼ã€‚è‹¥æœªæŒ‡å®šï¼Œç³»ç»Ÿä¼šä½¿ç”¨ tokenizer çš„é»˜è®¤ chat templateã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chat_template_path</span></code>: å¯é€‰çš„ chat template æ–‡ä»¶è·¯å¾„ï¼Œç±»å‹é€šå¸¸ä¸º jinja2ï¼›è‹¥è®¾ç½®ï¼Œåˆ™è¦†ç›– <code class="docutils literal notranslate"><span class="pre">custom_chat_template</span></code>ã€‚è‹¥æœªæŒ‡å®šï¼Œç³»ç»Ÿä¼šä½¿ç”¨ tokenizer çš„é»˜è®¤ chat templateã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_model_len</span></code>: è¡¨ç¤ºæ¨¡å‹æ‰€æ”¯æŒçš„å•ä¸ªåºåˆ—æœ€å¤§ token æ•°ã€‚å¦‚æœªæŒ‡å®šï¼Œç³»ç»Ÿä¼šå°è¯•å°†å…¶è®¾ä¸º <code class="docutils literal notranslate"><span class="pre">max_prompt_tokens</span></code> + <code class="docutils literal notranslate"><span class="pre">max_response_tokens</span></code>ã€‚ä½†å‰ææ˜¯è¿™ä¸¤ä¸ªå€¼éƒ½å¿…é¡»å·²è®¾ç½®ï¼Œå¦åˆ™å°†å¼•å‘é”™è¯¯ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_prompt_tokens</span></code>: è¾“å…¥ prompt ä¸­å…è®¸çš„æœ€å¤§ token æ•°ã€‚ä»…å¯¹ <code class="docutils literal notranslate"><span class="pre">InferenceModel</span></code> ä¸­çš„ <code class="docutils literal notranslate"><span class="pre">chat</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">generate</span></code> æ–¹æ³•ç”Ÿæ•ˆã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_response_tokens</span></code>: æ¨¡å‹ç”Ÿæˆçš„å›å¤ä¸­å…è®¸çš„æœ€å¤§ token æ•°ã€‚ä»…å¯¹ <code class="docutils literal notranslate"><span class="pre">InferenceModel</span></code> ä¸­çš„ <code class="docutils literal notranslate"><span class="pre">chat</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">generate</span></code> æ–¹æ³•ç”Ÿæ•ˆã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_response_tokens</span></code>: æ¨¡å‹ç”Ÿæˆçš„å›å¤ä¸­å…è®¸çš„æœ€å° token æ•°ã€‚ä»…å¯¹ <code class="docutils literal notranslate"><span class="pre">InferenceModel</span></code> ä¸­çš„ <code class="docutils literal notranslate"><span class="pre">chat</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">generate</span></code> æ–¹æ³•ç”Ÿæ•ˆã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enable_prompt_truncation</span></code>: æ˜¯å¦æˆªæ–­ promptã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">true</span></code>ã€‚è‹¥è®¾ç½®ä¸º <code class="docutils literal notranslate"><span class="pre">true</span></code>ï¼Œåˆ™ prompt å°†è¢«æˆªæ–­ä¸º <code class="docutils literal notranslate"><span class="pre">max_prompt_tokens</span></code> ä¸ª tokenï¼›è‹¥è®¾ç½®ä¸º <code class="docutils literal notranslate"><span class="pre">false</span></code>ï¼Œåˆ™ prompt ä¸ä¼šè¢«æˆªæ–­ï¼Œå­˜åœ¨ prompt å’Œ response é•¿åº¦ä¹‹å’Œè¶…è¿‡ <code class="docutils literal notranslate"><span class="pre">max_model_len</span></code> çš„é£é™©ã€‚åœ¨ OpenAI API æ¨¡å¼ä¸‹ä¸ç”Ÿæ•ˆã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">repetition_penalty</span></code>ï¼šé‡å¤æƒ©ç½šå› å­ã€‚é»˜è®¤å€¼ä¸º <code class="docutils literal notranslate"><span class="pre">1.0</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lora_configs</span></code>ï¼šå¯é€‰çš„ LoRA é…ç½®ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">null</span></code>ã€‚ç›®å‰ä»…æ”¯æŒä¸€ä¸ª LoRA é…ç½®ï¼Œå¹¶ä¸”å¦‚æœå¯ç”¨äº†<code class="docutils literal notranslate"><span class="pre">tinker</span></code>ï¼Œåˆ™ä¸ä¼šä½¿ç”¨æ­¤LoRAé…ç½®ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>ï¼šLoRA çš„åç§°ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">None</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>ï¼šLoRA çš„è·¯å¾„ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">None</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">base_model_name</span></code>ï¼šLoRA æ‰€åŸºäºçš„åŸºç¡€æ¨¡å‹åç§°ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">None</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lora_rank</span></code>ï¼šLoRA çš„ç§©ï¼ˆrankï¼‰ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">32</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lora_alpha</span></code>ï¼šLoRA çš„ alpha å€¼ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">32</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lora_dtype</span></code>ï¼šLoRA çš„æ•°æ®ç±»å‹ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">auto</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_modules</span></code>ï¼šLoRA çš„ç›®æ ‡æ¨¡å—åˆ—è¡¨ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">all-linear</span></code>ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">rope_scaling</span></code>ï¼šå¯é€‰çš„ RoPE ç¼©æ”¾é…ç½®ï¼Œé‡‡ç”¨ JSON æ ¼å¼ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">null</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rope_theta</span></code>ï¼šå¯é€‰çš„ RoPE theta å€¼ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">null</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tinker</span></code>ï¼šå¯é€‰çš„ Tinker é…ç½®ã€‚æ³¨æ„ï¼šè‹¥å¯ç”¨ Tinkerï¼Œåˆ™ LoRA é…ç½®å°†è¢«å¿½ç•¥ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">enable</span></code>ï¼šæ˜¯å¦å¯ç”¨ Tinkerã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">false</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rank</span></code>ï¼šæ§åˆ¶é€‚é…çŸ©é˜µå¤§å°çš„ LoRA ç§©ï¼ˆrankï¼‰ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">32</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seed</span></code>ï¼šTinker ä½¿ç”¨çš„éšæœºç§å­ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">null</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train_mlp</span></code>ï¼šæ˜¯å¦è®­ç»ƒ MLP å±‚ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">true</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train_attn</span></code>ï¼šæ˜¯å¦è®­ç»ƒæ³¨æ„åŠ›å±‚ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">true</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train_unembed</span></code>ï¼šæ˜¯å¦è®­ç»ƒååµŒå…¥ï¼ˆunembeddingï¼‰å±‚ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">true</span></code>ã€‚</p></li>
</ul>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">å°æŠ€å·§</p>
<p>å¦‚æœä½¿ç”¨çš„æ˜¯ Explorer æä¾›çš„ openai APIï¼Œåˆ™åªæœ‰ <code class="docutils literal notranslate"><span class="pre">max_model_len</span></code> ä¼šç”Ÿæ•ˆï¼Œè€Œ <code class="docutils literal notranslate"><span class="pre">max_response_tokens</span></code>ã€<code class="docutils literal notranslate"><span class="pre">max_prompt_tokens</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">min_response_tokens</span></code> çš„å€¼å°†è¢«å¿½ç•¥ï¼Œåœ¨æ²¡æœ‰ç‹¬ç«‹æŒ‡å®š <code class="docutils literal notranslate"><span class="pre">max_tokens</span></code> æ—¶ï¼Œæ¯æ¬¡ API è°ƒç”¨å°†ç”Ÿæˆæœ€å¤š <code class="docutils literal notranslate"><span class="pre">max_model_len</span> <span class="pre">-</span> <span class="pre">prompt_length</span></code> ä¸ª tokenï¼Œå› æ­¤åœ¨ä½¿ç”¨æ—¶è¯·ç¡®ä¿ prompt é•¿åº¦å°äº <code class="docutils literal notranslate"><span class="pre">max_model_len</span></code>ã€‚</p>
</div>
</section>
<hr class="docutils" />
<section id="cluster">
<h2>Cluster é…ç½®<a class="headerlink" href="#cluster" title="Link to this heading">#</a></h2>
<p>å®šä¹‰ä½¿ç”¨çš„é›†ç¾¤åŒ…å«çš„èŠ‚ç‚¹æ•°å’Œæ¯èŠ‚ç‚¹çš„ GPU æ•°ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">cluster</span><span class="p">:</span>
<span class="w">  </span><span class="nt">node_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">gpu_per_node</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">node_num</span></code>: è®¡ç®—èŠ‚ç‚¹æ€»æ•°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gpu_per_node</span></code>: æ¯èŠ‚ç‚¹å¯ç”¨çš„ GPU æ•°é‡ã€‚</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="buffer">
<h2>Buffer é…ç½®<a class="headerlink" href="#buffer" title="Link to this heading">#</a></h2>
<p>é…ç½® explorer å’Œ trainer ä½¿ç”¨çš„æ•°æ®ç¼“å†²åŒºï¼ˆBufferï¼‰ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">buffer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="w">  </span><span class="nt">train_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span>
<span class="w">  </span><span class="nt">total_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>

<span class="w">  </span><span class="nt">explorer_input</span><span class="p">:</span>
<span class="w">    </span><span class="nt">taskset</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">eval_tasksets</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">trainer_input</span><span class="p">:</span>
<span class="w">    </span><span class="nt">experience_buffer</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">auxiliary_buffers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">buffer_1</span><span class="p">:</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">      </span><span class="nt">buffer_2</span><span class="p">:</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">batch_size</span></code>: æ¯ä¸ªè®­ç»ƒæ­¥éª¤ä½¿ç”¨çš„ä»»åŠ¡æ•°ã€‚<em>è¯·å‹¿æ‰‹åŠ¨å°†æ­¤å€¼ä¹˜ä»¥ <code class="docutils literal notranslate"><span class="pre">algorithm.repeat_times</span></code></em>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train_batch_size</span></code>: æ¯ä¸ªè®­ç»ƒæ­¥éª¤ä½¿ç”¨çš„ experience æ•°é‡ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> * <code class="docutils literal notranslate"><span class="pre">algorithm.repeat_times</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_epochs</span></code>: æ€»è®­ç»ƒè½®æ•°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_steps</span></code>: æ€»è®­ç»ƒæ­¥æ•°ï¼ˆå¯é€‰ï¼‰ã€‚è‹¥æŒ‡å®šï¼Œåˆ™ <code class="docutils literal notranslate"><span class="pre">total_epochs</span></code> ä¸ç”Ÿæ•ˆã€‚</p></li>
</ul>
<section id="explorer">
<h3>Explorer è¾“å…¥é…ç½®<a class="headerlink" href="#explorer" title="Link to this heading">#</a></h3>
<p>å®šä¹‰ explorer ç”¨äºè®­ç»ƒå’Œè¯„ä¼°çš„æ•°æ®é›†ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">buffer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">explorer_input</span><span class="p">:</span>
<span class="w">    </span><span class="nt">default_workflow_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;math_workflow&#39;</span>
<span class="w">    </span><span class="nt">default_eval_workflow_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;math_workflow&#39;</span>
<span class="w">    </span><span class="nt">default_reward_fn_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;countdown_reward&#39;</span>
<span class="w">    </span><span class="nt">taskset</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">countdown_train</span>
<span class="w">      </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:TRINITY_TASKSET_PATH}</span>
<span class="w">      </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train</span>
<span class="w">      </span><span class="nt">format</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;question&#39;</span>
<span class="w">        </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;answer&#39;</span>
<span class="w">      </span><span class="nt">rollout_args</span><span class="p">:</span>
<span class="w">        </span><span class="nt">temperature</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">      </span><span class="nt">default_workflow_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;math_workflow&#39;</span>
<span class="w">      </span><span class="nt">default_reward_fn_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;countdown_reward&#39;</span>

<span class="w">    </span><span class="nt">eval_tasksets</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">countdown_eval</span>
<span class="w">      </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:TRINITY_TASKSET_PATH}</span>
<span class="w">      </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">      </span><span class="nt">repeat_times</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">format</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prompt_type</span><span class="p">:</span><span class="w"> </span><span class="err">`</span><span class="l l-Scalar l-Scalar-Plain">plaintext`</span>
<span class="w">        </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;question&#39;</span>
<span class="w">        </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;answer&#39;</span>
<span class="w">      </span><span class="nt">rollout_args</span><span class="p">:</span>
<span class="w">        </span><span class="nt">temperature</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.taskset</span></code>: ç”¨äºè®­ç»ƒæ¢ç´¢ç­–ç•¥çš„ä»»åŠ¡æ•°æ®é›†ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.eval_tasksets</span></code>: ç”¨äºè¯„æµ‹çš„ä»»åŠ¡æ•°æ®é›†åˆ—è¡¨ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.default_workflow_type</span></code>: è‹¥æœªåœ¨æ•°æ®é›†çº§åˆ«æŒ‡å®šï¼Œåˆ™ä¸ºæ‰€æœ‰ä»»åŠ¡æ•°æ®é›†è®¾ç½®é»˜è®¤çš„å·¥ä½œæµç±»å‹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.default_eval_workflow_type</span></code>: è‹¥æœªåœ¨æ•°æ®é›†çº§åˆ«æŒ‡å®šï¼Œåˆ™ä¸ºæ‰€æœ‰è¯„æµ‹ä»»åŠ¡æ•°æ®é›†è®¾ç½®é»˜è®¤çš„å·¥ä½œæµç±»å‹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer.explorer_input.default_reward_fn_type</span></code>: è‹¥æœªåœ¨æ•°æ®é›†çº§åˆ«æŒ‡å®šï¼Œåˆ™ä¸ºæ‰€æœ‰ä»»åŠ¡æ•°æ®é›†è®¾ç½®é»˜è®¤çš„å¥–åŠ±ç±»å‹ã€‚</p></li>
</ul>
<p>æ¯ä¸ªä»»åŠ¡æ•°æ®é›†çš„é…ç½®å®šä¹‰å¦‚ä¸‹ï¼š</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: æ•°æ®é›†åç§°ã€‚è¯¥åç§°å°†ç”¨ä½œ Ray actor çš„åç§°ï¼Œå› æ­¤å¿…é¡»å”¯ä¸€ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">storage_type</span></code>: æ•°æ®é›†çš„å­˜å‚¨æ–¹å¼ã€‚é€‰é¡¹ï¼š<code class="docutils literal notranslate"><span class="pre">file</span></code>ã€<code class="docutils literal notranslate"><span class="pre">queue</span></code>ã€<code class="docutils literal notranslate"><span class="pre">sql</span></code>ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">file</span></code>: æ•°æ®é›†å­˜å‚¨åœ¨ <code class="docutils literal notranslate"><span class="pre">jsonl</span></code>/<code class="docutils literal notranslate"><span class="pre">parquet</span></code> æ–‡ä»¶ä¸­ã€‚æ•°æ®æ–‡ä»¶ç»„ç»‡éœ€ç¬¦åˆ HuggingFace æ ‡å‡†ã€‚<em>å»ºè®®å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨æ­¤å­˜å‚¨ç±»å‹ã€‚</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sql</span></code>: æ•°æ®é›†å­˜å‚¨åœ¨ SQL æ•°æ®åº“ä¸­ã€‚<em>æ­¤ç±»å‹å°šä¸ç¨³å®šï¼Œå°†åœ¨æœªæ¥ç‰ˆæœ¬ä¸­ä¼˜åŒ–ã€‚</em></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: ä»»åŠ¡æ•°æ®é›†çš„è·¯å¾„ã€‚</p>
<ul>
<li><p>å¯¹äº <code class="docutils literal notranslate"><span class="pre">file</span></code> ç±»å‹ï¼Œè·¯å¾„æŒ‡å‘åŒ…å«ä»»åŠ¡æ•°æ®é›†æ–‡ä»¶çš„ç›®å½•ã€‚å®ƒæ”¯æŒä½¿ç”¨ä¸ <a class="reference external" href="https://huggingface.co/docs/datasets/main/en/package_reference/loading_methods#datasets.load_dataset"><code class="docutils literal notranslate"><span class="pre">datasets.load_dataset()</span></code></a> å‡½æ•°å…¼å®¹çš„æ ¼å¼åŠ è½½æœ¬åœ°å’Œè¿œç¨‹æ•°æ®æ–‡ä»¶ã€‚</p></li>
<li><p>å¯¹äº <code class="docutils literal notranslate"><span class="pre">sql</span></code> ç±»å‹ï¼Œè·¯å¾„æŒ‡å‘ sqlite æ•°æ®åº“æ–‡ä»¶ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">subset_name</span></code>: ä»»åŠ¡æ•°æ®é›†çš„å­é›†åç§°ï¼Œå¯¹åº” huggingface datasets <code class="docutils literal notranslate"><span class="pre">load_dataset</span></code> å‡½æ•°ä¸­çš„ <code class="docutils literal notranslate"><span class="pre">name</span></code> å‚æ•°ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">None</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split</span></code>: ä»»åŠ¡æ•°æ®é›†çš„åˆ’åˆ†ã€‚å¯¹åº” huggingface datasets <code class="docutils literal notranslate"><span class="pre">load_dataset</span></code> å‡½æ•°ä¸­çš„ <code class="docutils literal notranslate"><span class="pre">split</span></code> å‚æ•°ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">train</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">repeat_times</span></code>: ä¸ºä¸€ä¸ªä»»åŠ¡ç”Ÿæˆçš„ rollout æ•°é‡ã€‚è‹¥æœªè®¾ç½®ï¼Œåˆ™è‡ªåŠ¨è®¾ä¸º <code class="docutils literal notranslate"><span class="pre">algorithm.repeat_times</span></code>ï¼ˆ<code class="docutils literal notranslate"><span class="pre">taskset</span></code>ï¼‰æˆ– <code class="docutils literal notranslate"><span class="pre">1</span></code>ï¼ˆ<code class="docutils literal notranslate"><span class="pre">eval_tasksets</span></code>ï¼‰ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rollout_args</span></code>: rollout å‚æ•°ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">temperature</span></code>: é‡‡æ ·æ¸©åº¦ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_workflow_type</span></code>: åº”ç”¨äºè¯¥æ•°æ®é›†çš„å·¥ä½œæµé€»è¾‘ç±»å‹ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">buffer.default_workflow_type</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_reward_fn_type</span></code>: æ¢ç´¢è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å¥–åŠ±å‡½æ•°ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">buffer.default_reward_fn_type</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">workflow_args</span></code>: ç”¨äºè¡¥å……æ•°æ®é›†çº§åˆ«å‚æ•°çš„å­—å…¸ã€‚</p></li>
</ul>
</section>
<section id="trainer">
<h3>Trainer è¾“å…¥é…ç½®<a class="headerlink" href="#trainer" title="Link to this heading">#</a></h3>
<p>å®šä¹‰ trainer ä½¿ç”¨çš„ experience buffer å’Œå¯é€‰çš„è¾…åŠ©æ•°æ®é›†ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">buffer</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">trainer_input</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="nt">experience_buffer</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">countdown_buffer</span>
<span class="w">      </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">queue</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sqlite:///countdown_buffer.db</span>
<span class="w">      </span><span class="nt">max_read_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1800</span>

<span class="w">    </span><span class="nt">auxiliary_buffers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sft_dataset</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sft_dataset</span>
<span class="w">        </span><span class="nt">storage_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:TRINITY_SFT_DATASET_PATH}</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;question&#39;</span>
<span class="w">          </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;answer&#39;</span>
<span class="w">      </span><span class="nt">other_buffer</span><span class="p">:</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">experience_buffer</span></code>: å®ƒæ˜¯ Trainer çš„è¾“å…¥ï¼Œä¹Ÿæ˜¯ Explorer çš„è¾“å‡ºã€‚å³ä½¿åœ¨ explore æ¨¡å¼ä¸‹ä¹Ÿå¿…é¡»å®šä¹‰ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: experience buffer çš„åç§°ã€‚è¯¥åç§°å°†ç”¨ä½œ Ray actor çš„åç§°ï¼Œå› æ­¤å¿…é¡»å”¯ä¸€ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">storage_type</span></code>: experience buffer çš„å­˜å‚¨ç±»å‹ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">queue</span></code>: experience æ•°æ®å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯æ¨èæ­¤ç±»å‹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sql</span></code>: experience æ•°æ®å­˜å‚¨åœ¨ SQL æ•°æ®åº“ä¸­ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">file</span></code>: experience æ•°æ®å­˜å‚¨åœ¨ JSON æ–‡ä»¶ä¸­ã€‚ä»…å»ºè®®åœ¨ <code class="docutils literal notranslate"><span class="pre">explore</span></code> æ¨¡å¼ä¸‹ç”¨äºè°ƒè¯•ç›®çš„ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: experience buffer çš„è·¯å¾„ã€‚</p>
<ul>
<li><p>å¯¹äº <code class="docutils literal notranslate"><span class="pre">queue</span></code> ç±»å‹ï¼Œæ­¤å­—æ®µå¯é€‰ã€‚å¯åœ¨æ­¤æŒ‡å®š SQLite æ•°æ®åº“æˆ– JSON æ–‡ä»¶è·¯å¾„ä»¥å¤‡ä»½é˜Ÿåˆ—æ•°æ®ã€‚</p></li>
<li><p>å¯¹äº <code class="docutils literal notranslate"><span class="pre">file</span></code> ç±»å‹ï¼Œè·¯å¾„æŒ‡å‘åŒ…å«æ•°æ®é›†æ–‡ä»¶çš„ç›®å½•ã€‚</p></li>
<li><p>å¯¹äº <code class="docutils literal notranslate"><span class="pre">sql</span></code> ç±»å‹ï¼Œè·¯å¾„æŒ‡å‘ SQLite æ•°æ®åº“æ–‡ä»¶ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">format</span></code>: ä¸»è¦é’ˆå¯¹ SFT å’Œ DPO ç®—æ³•çš„æ•°æ®é›†ï¼Œç”¨äºè§„èŒƒåŒ–æå–çš„æ•°æ®ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">prompt_type</span></code>: æŒ‡å®šæ•°æ®é›†ä¸­ prompt çš„ç±»å‹ã€‚ç›®å‰æ”¯æŒ <code class="docutils literal notranslate"><span class="pre">plaintext</span></code>ã€<code class="docutils literal notranslate"><span class="pre">messages</span></code>ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">plaintext</span></code>: prompt ä¸º string æ ¼å¼ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">messages</span></code>: prompt ä¸ºæ¶ˆæ¯åˆ—è¡¨ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">prompt_key</span></code>: æŒ‡å®šæ•°æ®é›†ä¸­åŒ…å«ç”¨æˆ· prompt çš„åˆ—ã€‚ä»…é€‚ç”¨äº <code class="docutils literal notranslate"><span class="pre">plaintext</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">response_key</span></code>: æŒ‡å®šæ•°æ®é›†ä¸­åŒ…å« response çš„åˆ—ã€‚ä»…é€‚ç”¨äº <code class="docutils literal notranslate"><span class="pre">plaintext</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">system_prompt_key</span></code>: æŒ‡å®šæ•°æ®é›†ä¸­åŒ…å« system prompt çš„åˆ—ã€‚ä»…é€‚ç”¨äº <code class="docutils literal notranslate"><span class="pre">plaintext</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">system_prompt</span></code>: ä»¥å­—ç¬¦ä¸²å½¢å¼æŒ‡å®š system promptã€‚ä¼˜å…ˆçº§ä½äº <code class="docutils literal notranslate"><span class="pre">system_prompt_key</span></code>ã€‚ä»…é€‚ç”¨äº <code class="docutils literal notranslate"><span class="pre">plaintext</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">messages_key</span></code>: æŒ‡å®šæ•°æ®é›†ä¸­åŒ…å« messages çš„åˆ—ã€‚ä»…é€‚ç”¨äº <code class="docutils literal notranslate"><span class="pre">messages</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tools_key</span></code>: æŒ‡å®šæ•°æ®é›†ä¸­åŒ…å« tools çš„åˆ—ã€‚æ”¯æŒ <code class="docutils literal notranslate"><span class="pre">plaintext</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">messages</span></code>ï¼Œä½† tool æ•°æ®åº”ç»„ç»‡ä¸º dict åˆ—è¡¨ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chosen_key</span></code>: æŒ‡å®šæ•°æ®é›†ä¸­åŒ…å« DPO chosen æ•°æ®çš„åˆ—ã€‚æ”¯æŒ <code class="docutils literal notranslate"><span class="pre">plaintext</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">messages</span></code>ï¼Œæ•°æ®ç±»å‹åº”ä¸ prompt ç±»å‹ä¸€è‡´ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rejected_key</span></code>: ç±»ä¼¼äº <code class="docutils literal notranslate"><span class="pre">chosen_key</span></code>ï¼Œä½†æŒ‡å®š DPO rejected æ•°æ®çš„åˆ—ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enable_concatenated_multi_turn</span></code>: å¯ç”¨æ‹¼æ¥çš„å¤šè½® SFT æ•°æ®é¢„å¤„ç†ã€‚ä»…é€‚ç”¨äº <code class="docutils literal notranslate"><span class="pre">messages</span></code>ï¼Œä¸”ä»…åœ¨ SFT ç®—æ³•ä¸­ç”Ÿæ•ˆã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chat_template</span></code>: ä»¥å­—ç¬¦ä¸²å½¢å¼æŒ‡å®š chat templateã€‚è‹¥æœªæä¾›ï¼Œåˆ™ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">model.custom_chat_template</span></code>ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_read_timeout</span></code>: è¯»å–æ–° experience æ•°æ®çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ã€‚è‹¥è¶…æ—¶ï¼Œåˆ™ç›´æ¥è¿”å›ä¸å®Œæ•´æ‰¹æ¬¡ã€‚ä»…å½“ <code class="docutils literal notranslate"><span class="pre">storage_type</span></code> ä¸º <code class="docutils literal notranslate"><span class="pre">queue</span></code> æ—¶ç”Ÿæ•ˆã€‚é»˜è®¤ä¸º 1800 ç§’ï¼ˆ30 åˆ†é’Ÿï¼‰ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">replay_buffer</span></code>: ä»…å½“ <code class="docutils literal notranslate"><span class="pre">storage_type</span></code> ä¸º <code class="docutils literal notranslate"><span class="pre">queue</span></code> æ—¶ç”Ÿæ•ˆã€‚ç”¨äºé…ç½® experience é‡ç”¨çš„å›æ”¾ç¼“å†²åŒºã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">enable</span></code>: æ˜¯å¦å°† experience æ”¾å›ç¼“å†²åŒºã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">false</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reuse_cooldown_time</span></code>: experience é‡ç”¨çš„å†·å´æ—¶é—´ï¼ˆç§’ï¼‰ã€‚è‹¥æœªæŒ‡å®šï¼Œé»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">None</span></code>ï¼Œè¡¨ç¤º experience ä¸å¯è¢«é‡å¤ä½¿ç”¨ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority_fn</span></code>: experience ä¼˜å…ˆçº§å‡½æ•°ï¼Œç”¨äºç¡®å®š experience çš„é‡ç”¨é¡ºåºã€‚ç›®å‰æ”¯æŒ <code class="docutils literal notranslate"><span class="pre">linear_decay</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">linear_decay_use_count_control_randomization</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority_fn_args</span></code>: ä¼ é€’ç»™ä¼˜å…ˆçº§å‡½æ•°çš„å‚æ•°å­—å…¸ï¼Œå…·ä½“å‚æ•°å–å†³äºæ‰€é€‰çš„ä¼˜å…ˆçº§å‡½æ•°ã€‚</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">auxiliary_buffers</span></code>: trainer ä½¿ç”¨çš„å¯é€‰ç¼“å†²åŒºã€‚ä¸ºå­—å…¸ç»“æ„ï¼Œæ¯ä¸ªé”®ä¸º buffer åç§°ï¼Œå€¼ä¸º buffer é…ç½®ã€‚æ¯ä¸ª buffer é…ç½®ä¸ <code class="docutils literal notranslate"><span class="pre">experience_buffer</span></code> ç±»ä¼¼ã€‚</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="id6">
<h2>Explorer é…ç½®<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<p>æ§åˆ¶ rollout æ¨¡å‹å’Œå·¥ä½œæµæ‰§è¡Œã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">explorer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explorer</span>
<span class="w">  </span><span class="nt">runner_per_model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">  </span><span class="nt">max_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900</span>
<span class="w">  </span><span class="nt">max_retry_times</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">env_vars</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">rollout_model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">engine_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vllm</span>
<span class="w">    </span><span class="nt">engine_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">tensor_parallel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">enable_history</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">auxiliary_models</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Qwen/Qwen2.5-7B-Instruct</span>
<span class="w">    </span><span class="nt">tensor_parallel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">eval_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">  </span><span class="nt">eval_on_startup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">over_rollout</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="nt">wait_after_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30.0</span>
<span class="w">  </span><span class="nt">dynamic_timeout</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0</span>
<span class="w">  </span><span class="nt">runner_state_report_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: explorer çš„åç§°ã€‚è¯¥åç§°å°†ç”¨ä½œ Ray actor çš„åç§°ï¼Œå› æ­¤å¿…é¡»å”¯ä¸€ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runner_per_model</span></code>: æ¯ä¸ªæ¨ç†å¼•æ“å®ä¾‹æ‰€æœåŠ¡çš„ WorkflowRunner æ•°é‡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_timeout</span></code>: ç­‰å¾… Workflow å®Œæˆçš„æœ€å¤§æ—¶é—´ï¼ˆç§’ï¼‰ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_retry_times</span></code>: Workflow å¤±è´¥æˆ–è¶…æ—¶æƒ…å†µä¸‹çš„æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">env_vars</span></code>: ä¸ºæ¯ä¸ª WorkflowRunner è®¾ç½®çš„ç¯å¢ƒå˜é‡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rollout_model.engine_type</span></code>: æ¨ç†å¼•æ“ç±»å‹ã€‚æ”¯æŒ <code class="docutils literal notranslate"><span class="pre">vllm_async</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">vllm</span></code>ï¼ŒäºŒè€…çš„å«ä¹‰ç›¸åŒï¼Œéƒ½ä½¿ç”¨äº†å¼‚æ­¥å¼•æ“ã€‚åç»­ç‰ˆæœ¬ä¼šåªä¿ç•™ <code class="docutils literal notranslate"><span class="pre">vllm</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rollout_model.engine_num</span></code>: æ¨ç†å¼•æ“å®ä¾‹çš„æ•°é‡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rollout_model.tensor_parallel_size</span></code>: æ¯ä¸ªå®ä¾‹çš„å¼ é‡å¹¶è¡Œåº¦ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rollout_model.enable_history</span></code>: æ˜¯å¦å¯ç”¨æ¨¡å‹è°ƒç”¨å†å²è®°å½•åŠŸèƒ½ã€‚è‹¥è®¾ä¸º <code class="docutils literal notranslate"><span class="pre">True</span></code>ï¼Œæ¨¡å‹ä¼šè‡ªåŠ¨è®°å½•è°ƒç”¨è¿”å›çš„ experienceã€‚è¯·å®šæœŸé€šè¿‡ <code class="docutils literal notranslate"><span class="pre">extract_experience_from_history</span></code> æå–å†å²ï¼Œä»¥é¿å…å†…å­˜æº¢å‡ºã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">False</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auxiliary_models</span></code>: ç”¨äºè‡ªå®šä¹‰å·¥ä½œæµçš„è¾…åŠ©æ¨¡å‹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eval_interval</span></code>: æ¨¡å‹è¯„ä¼°çš„é—´éš”ï¼ˆä»¥ step ä¸ºå•ä½ï¼‰ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eval_on_startup</span></code>: æ˜¯å¦åœ¨å¯åŠ¨æ—¶è¯„ä¼°æ¨¡å‹ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯åœ¨ç¬¬ 0 æ­¥ä½¿ç”¨åŸå§‹æ¨¡å‹è¯„ä¼°ï¼Œå› æ­¤ä¸­æ–­è®­ç»ƒåé‡å¯æ—¶ä¸ä¼šè§¦å‘è¯¥è¡Œä¸ºã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">over_rollout</span></code>: [å®éªŒæ€§] è¶…é‡ rollout æœºåˆ¶çš„é…ç½®ï¼Œå…è®¸ explorer åœ¨æ¯ä¸ªæ­¥éª¤ä¸­ä½¿ç”¨å°‘äºå®Œæ•´æ‰¹æ¬¡å¤§å°çš„ä»»åŠ¡ç»§ç»­è¿›è¡Œã€‚è¿™åœ¨æŸäº›ä»»åŠ¡æ˜¾è‘—è€—æ—¶è¾ƒé•¿çš„åœºæ™¯ä¸­èƒ½æœ‰æ•ˆåœ°æé«˜ååé‡ã€‚ä»…å½“ä½¿ç”¨åŠ¨æ€åŒæ­¥ï¼ˆ<code class="docutils literal notranslate"><span class="pre">synchronizer.sync_style</span></code> ä¸æ˜¯ <code class="docutils literal notranslate"><span class="pre">fixed</span></code>ï¼‰æ—¶é€‚ç”¨ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ratio</span></code>: explorer åœ¨æ¯ä¸ªæ­¥éª¤ä¸­ä»…ç­‰å¾… <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">-</span> <span class="pre">ratio)</span> <span class="pre">*</span> <span class="pre">batch_size</span></code> çš„ä»»åŠ¡ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">0.0</span></code>ï¼Œè¡¨ç¤ºç­‰å¾…æ‰€æœ‰ä»»åŠ¡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wait_after_min</span></code>: è¾¾åˆ°æœ€å°ä»»åŠ¡é˜ˆå€¼åï¼Œç­‰å¾…æ­¤ç§’æ•°åå†ç»§ç»­ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dynamic_timeout</span></code>: [å®éªŒæ€§] åŠ¨æ€è¶…æ—¶æœºåˆ¶çš„é…ç½®ï¼Œæ ¹æ®æˆåŠŸä»»åŠ¡çš„å¹³å‡è€—æ—¶è°ƒæ•´æ¯ä¸ªä»»åŠ¡çš„è¶…æ—¶æ—¶é—´ã€‚</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">enable</span></code>: æ˜¯å¦å¯ç”¨åŠ¨æ€è¶…æ—¶ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">false</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ratio</span></code>: æ¯ä¸ªä»»åŠ¡çš„è¶…æ—¶æ—¶é—´åŠ¨æ€è®¾ç½®ä¸º <code class="docutils literal notranslate"><span class="pre">average_time_per_success_task</span> <span class="pre">*</span> <span class="pre">ratio</span></code>ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">3.0</span></code>ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">runner_state_report_interval</span></code>: WorkflowRunner æŠ¥å‘Šè‡ªèº«çŠ¶æ€çš„æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰ã€‚è‹¥è®¾ä¸ºå¤§äº 0 çš„å€¼ï¼Œå·¥ä½œæµæ‰§è¡Œå™¨ä¼šå®šæœŸå°†å…¶çŠ¶æ€æŠ¥å‘Šç»™ explorer ä¸»è¿›ç¨‹å¹¶æ‰“å°åœ¨å‘½ä»¤è¡Œä¸­ï¼Œä»¥ä¾¿ç›‘æ§å…¶è¿è¡ŒçŠ¶æ€ã€‚é»˜è®¤ä¸º <code class="docutils literal notranslate"><span class="pre">0</span></code>ï¼Œè¡¨ç¤ºä¸å¯ç”¨æ­¤åŠŸèƒ½ã€‚æ¨èå¦‚éœ€ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œå°†å…¶è®¾ç½®ä¸º <code class="docutils literal notranslate"><span class="pre">10</span></code> ç§’æˆ–æ›´é•¿æ—¶é—´ä»¥å‡å°‘å¯¹æ€§èƒ½çš„å½±å“ã€‚</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="synchronizer">
<h2>Synchronizer é…ç½®<a class="headerlink" href="#synchronizer" title="Link to this heading">#</a></h2>
<p>æ§åˆ¶ trainer å’Œ explorer ä¹‹é—´çš„æ¨¡å‹æƒé‡åŒæ­¥æ–¹å¼ã€‚è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ <a class="reference internal" href="synchronizer.html#synchronizer"><span class="std std-ref">Synchronizer ä»‹ç»</span></a>ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">synchronizer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">sync_method</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;nccl&#39;</span>
<span class="w">  </span><span class="nt">sync_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">  </span><span class="nt">sync_offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">sync_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1200</span>
<span class="w">  </span><span class="nt">sync_style</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;fixed&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sync_method</span></code>: åŒæ­¥æ–¹æ³•ã€‚é€‰é¡¹ï¼š</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">nccl</span></code>: ä½¿ç”¨ NCCL è¿›è¡Œå¿«é€ŸåŒæ­¥ã€‚ä»… <code class="docutils literal notranslate"><span class="pre">both</span></code> æ¨¡å¼æ”¯æŒã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checkpoint</span></code>: ä»ç£ç›˜åŠ è½½æœ€æ–°æ¨¡å‹ã€‚<code class="docutils literal notranslate"><span class="pre">train</span></code>ã€<code class="docutils literal notranslate"><span class="pre">explore</span></code> æˆ– <code class="docutils literal notranslate"><span class="pre">bench</span></code> æ¨¡å¼å‡æ”¯æŒã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sync_interval</span></code>: trainer å’Œ explorer ä¹‹é—´æ¨¡å‹æƒé‡åŒæ­¥çš„é—´éš”ï¼ˆæ­¥ï¼‰ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sync_offset</span></code>: trainer å’Œ explorer ä¹‹é—´æ¨¡å‹æƒé‡åŒæ­¥çš„åç§»é‡ï¼ˆæ­¥ï¼‰ã€‚explorer å¯åœ¨ trainer å¼€å§‹è®­ç»ƒå‰è¿è¡Œ <code class="docutils literal notranslate"><span class="pre">sync_offset</span></code> æ­¥ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sync_timeout</span></code>: åŒæ­¥è¶…æ—¶æ—¶é—´ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sync_style</span></code>: åŒæ­¥é£æ ¼ã€‚é€‰é¡¹ï¼š</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">fixed</span></code>: explorer å’Œ trainer æ¯éš” <code class="docutils literal notranslate"><span class="pre">sync_interval</span></code> æ­¥åŒæ­¥ä¸€æ¬¡æƒé‡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dynamic_by_explorer</span></code>: explorer åœ¨å®Œæˆ <code class="docutils literal notranslate"><span class="pre">sync_interval</span></code> æ­¥åé€šçŸ¥ trainer åŒæ­¥æƒé‡ï¼Œè€Œä¸ç®¡æ­¤æ—¶ trainer å·²å®Œæˆå¤šå°‘æ­¥ã€‚</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="id7">
<h2>Trainer é…ç½®<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<p>æŒ‡å®š trainer çš„åç«¯å’Œè¡Œä¸ºã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">trainer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trainer</span>
<span class="w">  </span><span class="nt">trainer_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;verl&quot;</span>
<span class="w">  </span><span class="nt">trainer_strategy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fsdp&quot;</span>
<span class="w">  </span><span class="nt">total_steps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">  </span><span class="nt">save_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">  </span><span class="nt">save_strategy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unrestricted&quot;</span>
<span class="w">  </span><span class="nt">save_hf_checkpoint</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;last&quot;</span>
<span class="w">  </span><span class="nt">grad_clip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">  </span><span class="nt">use_dynamic_bsz</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">max_token_len_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16384</span>
<span class="w">  </span><span class="nt">ulysses_sequence_parallel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">trainer_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: trainer çš„åç§°ã€‚è¯¥åç§°å°†ç”¨ä½œ Ray actor çš„åç§°ï¼Œå› æ­¤å¿…é¡»å”¯ä¸€ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer_type</span></code>: trainer åç«¯å®ç°ã€‚ç›®å‰ä»…æ”¯æŒ <code class="docutils literal notranslate"><span class="pre">verl</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer_strategy</span></code>: VeRL çš„è®­ç»ƒç­–ç•¥ã€‚é»˜è®¤å€¼ä¸º <code class="docutils literal notranslate"><span class="pre">fsdp</span></code>ã€‚å¯é€‰å€¼å¦‚ä¸‹ï¼š</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">fsdp</span></code>: ä½¿ç”¨ PyTorch FSDPã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fsdp2</span></code>: ä½¿ç”¨ PyTorch FSDP2ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">megatron</span></code>: ä½¿ç”¨ Megatron-LMã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">save_interval</span></code>: ä¿å­˜æ¨¡å‹æ£€æŸ¥ç‚¹çš„é¢‘ç‡ï¼ˆæ­¥ï¼‰ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_steps</span></code>: æ€»è®­ç»ƒæ­¥æ•°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save_strategy</span></code>: æ¨¡å‹ä¿å­˜æ—¶çš„å¹¶è¡Œç­–ç•¥ã€‚é»˜è®¤å€¼ä¸º<code class="docutils literal notranslate"><span class="pre">unrestricted</span></code>ã€‚å¯é€‰å€¼å¦‚ä¸‹ï¼š</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">single_thread</span></code>ï¼šæ•´ä¸ªç³»ç»Ÿä¸­ï¼Œä»…å…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ¨¡å‹ä¿å­˜ï¼Œä¸åŒä¿å­˜çº¿ç¨‹ä¹‹é—´ä¸²è¡Œæ‰§è¡Œã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">single_process</span></code>ï¼šæ•´ä¸ªç³»ç»Ÿä¸­ï¼Œä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œä¿å­˜ï¼Œè¯¥è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶è¡Œå¤„ç†ä¿å­˜ä»»åŠ¡ï¼Œä¸åŒè¿›ç¨‹ä¹‹é—´ä¸²è¡Œæ‰§è¡Œã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">single_node</span></code>ï¼šæ•´ä¸ªç³»ç»Ÿä¸­ï¼Œä»…å…è®¸ä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹æ‰§è¡Œä¿å­˜ï¼Œè¯¥èŠ‚ç‚¹å†…çš„è¿›ç¨‹å’Œçº¿ç¨‹å¯å¹¶è¡Œå·¥ä½œï¼Œä¸åŒèŠ‚ç‚¹çš„ä¿å­˜ä¸²è¡Œæ‰§è¡Œã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unrestricted</span></code>ï¼šä¸é™åˆ¶ä¿å­˜æ“ä½œï¼Œå…è®¸å¤šä¸ªèŠ‚ç‚¹ã€è¿›ç¨‹æˆ–çº¿ç¨‹åŒæ—¶ä¿å­˜æ¨¡å‹ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">save_hf_checkpoint</span></code>: æŒ‡å®šä¿å­˜ HuggingFace æ ¼å¼æ£€æŸ¥ç‚¹çš„æ—¶æœºï¼Œé»˜è®¤ä¸º &quot;last&quot;ã€‚æ³¨æ„åœ¨ä¿å­˜ä¸º HuggingFace æ ¼å¼ä¼šæ¶ˆè€—é¢å¤–çš„æ—¶é—´ã€å­˜å‚¨ç©ºé—´å’Œæ˜¾å­˜ï¼Œå¯èƒ½å½±å“è®­ç»ƒæ€§èƒ½æˆ–å¯¼è‡´æ˜¾å­˜ä¸è¶³é”™è¯¯ã€‚å¯é€‰å€¼ï¼š</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">last</span></code>: ä»…è®­ç»ƒäº§ç”Ÿçš„æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹ä¿å­˜ä¸º HuggingFace æ ¼å¼ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">always</span></code>: æ‰€æœ‰æ£€æŸ¥ç‚¹å‡ä¿å­˜ä¸º HuggingFace æ ¼å¼ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">never</span></code>: ä¸ä¿å­˜ HuggingFace æ ¼å¼æ£€æŸ¥ç‚¹ã€‚</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grad_clip</span></code>: æ¢¯åº¦è£å‰ªé˜ˆå€¼ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_dynamic_bsz</span></code>: æ˜¯å¦ä½¿ç”¨åŠ¨æ€æ‰¹é‡å¤§å°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_token_len_per_gpu</span></code>: è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ª GPU æœ€å¤§ token é•¿åº¦; å½“ <code class="docutils literal notranslate"><span class="pre">use_dynamic_bsz=true</span></code> æ—¶ç”Ÿæ•ˆã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ulysses_sequence_parallel_size</span></code>: åºåˆ—å¹¶è¡Œçš„å¹¶è¡Œåº¦ï¼Œå³ç”¨äºåˆ†å‰²å•ä¸ªåºåˆ—çš„ GPU æ•°é‡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer_config</span></code>: å†…è”æä¾›çš„ trainer é…ç½®ã€‚</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="service">
<h2>Service é…ç½®<a class="headerlink" href="#service" title="Link to this heading">#</a></h2>
<p>é…ç½® Trinity-RFT ä½¿ç”¨çš„æœåŠ¡ã€‚ç›®å‰ä»…æ”¯æŒ Data Juicer æœåŠ¡ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service</span><span class="p">:</span>
<span class="w">  </span><span class="nt">data_juicer</span><span class="p">:</span>
<span class="w">    </span><span class="nt">server_url</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;http://127.0.0.1:5005&#39;</span>
<span class="w">    </span><span class="nt">auto_start</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5005</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">server_url</span></code>: data juicer æœåŠ¡çš„ URLã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auto_start</span></code>: æ˜¯å¦è‡ªåŠ¨å¯åŠ¨ data juicer æœåŠ¡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code>: å½“ <code class="docutils literal notranslate"><span class="pre">auto_start</span></code> ä¸º true æ—¶ï¼ŒData Juicer æœåŠ¡ä½¿ç”¨çš„ç«¯å£ã€‚</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="dataprocessor">
<h2>DataProcessor é…ç½®<a class="headerlink" href="#dataprocessor" title="Link to this heading">#</a></h2>
<p>é…ç½® task / experience å¤„ç†æµæ°´çº¿ï¼Œè¯¦æƒ…è¯·å‚è€ƒ <a class="reference internal" href="example_data_functionalities.html#data-processing"><span class="std std-ref">æ•°æ®å¤„ç†</span></a> éƒ¨åˆ†ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data_processor</span><span class="p">:</span>
<span class="w">  </span><span class="nt">task_pipeline</span><span class="p">:</span>
<span class="w">    </span><span class="nt">num_process</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="w">    </span><span class="nt">operators</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;llm_difficulty_score_filter&quot;</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span>
<span class="w">          </span><span class="nt">api_or_hf_model</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;qwen2.5-7b-instruct&quot;</span>
<span class="w">          </span><span class="nt">min_score</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">          </span><span class="nt">input_keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;question&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;answer&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;Question&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;Answer&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span><span class="w">  </span><span class="c1"># è¾“å‡ºå°†è‡ªåŠ¨è®¾ç½®ä¸º explorer è¾“å…¥</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:TRINITY_TASKSET_PATH}</span>
<span class="w">    </span><span class="nt">target_fields</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;question&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;answer&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">experience_pipeline</span><span class="p">:</span>
<span class="w">    </span><span class="nt">operators</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data_juicer</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span>
<span class="w">          </span><span class="nt">config_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;examples/grpo_gsm8k_experience_pipeline/dj_scoring_exp.yaml&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reward_shaping_mapper</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span>
<span class="w">          </span><span class="nt">reward_shaping_configs</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">stats_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;llm_quality_score&#39;</span>
<span class="w">              </span><span class="nt">op_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ADD</span>
<span class="w">              </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
</pre></div>
</div>
<p>--</p>
</section>
<section id="log">
<h2>Log é…ç½®<a class="headerlink" href="#log" title="Link to this heading">#</a></h2>
<p>Ray actor æ—¥å¿—é…ç½®ã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">log</span><span class="p">:</span>
<span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>
<span class="w">  </span><span class="nt">group_by_node</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">level</span></code>: æ—¥å¿—çº§åˆ«ï¼ˆæ”¯æŒ <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>ã€<code class="docutils literal notranslate"><span class="pre">INFO</span></code>ã€<code class="docutils literal notranslate"><span class="pre">WARNING</span></code>ã€<code class="docutils literal notranslate"><span class="pre">ERROR</span></code>ï¼‰ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">group_by_node</span></code>: æ˜¯å¦æŒ‰èŠ‚ç‚¹ IP åˆ†ç»„æ—¥å¿—ã€‚è‹¥è®¾ä¸º <code class="docutils literal notranslate"><span class="pre">True</span></code>ï¼Œactor çš„æ—¥å¿—å°†ä¿å­˜åˆ° <code class="docutils literal notranslate"><span class="pre">&lt;checkpoint_root_dir&gt;/&lt;project&gt;/&lt;name&gt;/log/&lt;node_ip&gt;/&lt;actor_name&gt;.log</span></code>ï¼Œå¦åˆ™ä¿å­˜åˆ° <code class="docutils literal notranslate"><span class="pre">&lt;checkpoint_root_dir&gt;/&lt;project&gt;/&lt;name&gt;/log/&lt;actor_name&gt;.log</span></code>ã€‚</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="stage">
<h2>Stage é…ç½®<a class="headerlink" href="#stage" title="Link to this heading">#</a></h2>
<p>å¯¹äºå¤šé˜¶æ®µè®­ç»ƒï¼Œå¯ä»¥åœ¨ <code class="docutils literal notranslate"><span class="pre">stages</span></code> å­—æ®µä¸­å®šä¹‰å¤šä¸ªé˜¶æ®µã€‚æ¯ä¸ªé˜¶æ®µå¯ä»¥æœ‰è‡ªå·±çš„ <code class="docutils literal notranslate"><span class="pre">algorithm</span></code>ã€<code class="docutils literal notranslate"><span class="pre">buffer</span></code> å’Œå…¶ä»–é…ç½®ã€‚å¦‚æœæŸä¸ªå‚æ•°æœªåœ¨é˜¶æ®µä¸­æŒ‡å®šï¼Œåˆ™ç»§æ‰¿è‡ªå…¨å±€é…ç½®ã€‚å¤šä¸ªé˜¶æ®µå°†æŒ‰å®šä¹‰é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">stage_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sft_warmup</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train</span>
<span class="w">    </span><span class="nt">algorithm</span><span class="p">:</span>
<span class="w">      </span><span class="nt">algorithm_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sft</span>
<span class="w">    </span><span class="nt">buffer</span><span class="p">:</span>
<span class="w">      </span><span class="nt">train_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64</span>
<span class="w">      </span><span class="nt">total_steps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">      </span><span class="nt">trainer_input</span><span class="p">:</span>
<span class="w">        </span><span class="nt">experience_buffer</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sft_buffer</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${oc.env:TRINITY_DATASET_PATH}</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">stage_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rft</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stage_name</span></code>: é˜¶æ®µåç§°ã€‚åº”å”¯ä¸€ï¼Œå¹¶å°†ç”¨ä½œå®éªŒåç§°çš„åç¼€ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>: è¯¥é˜¶æ®µ Trinity-RFT çš„è¿è¡Œæ¨¡å¼ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™ç»§æ‰¿è‡ªå…¨å±€ <code class="docutils literal notranslate"><span class="pre">mode</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">algorithm</span></code>: è¯¥é˜¶æ®µçš„ç®—æ³•é…ç½®ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™ç»§æ‰¿è‡ªå…¨å±€ <code class="docutils literal notranslate"><span class="pre">algorithm</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer</span></code>: è¯¥é˜¶æ®µçš„ç¼“å†²åŒºé…ç½®ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™ç»§æ‰¿è‡ªå…¨å±€ <code class="docutils literal notranslate"><span class="pre">buffer</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">explorer</span></code>: è¯¥é˜¶æ®µçš„ explorer é…ç½®ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™ç»§æ‰¿è‡ªå…¨å±€ <code class="docutils literal notranslate"><span class="pre">explorer</span></code>ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer</span></code>: è¯¥é˜¶æ®µçš„ trainer é…ç½®ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™ç»§æ‰¿è‡ªå…¨å±€ <code class="docutils literal notranslate"><span class="pre">trainer</span></code>ã€‚</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="verl-trainer">
<h2>veRL Trainer é…ç½®ï¼ˆé«˜çº§ï¼‰<a class="headerlink" href="#verl-trainer" title="Link to this heading">#</a></h2>
<p>é’ˆå¯¹ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">verl</span></code> trainer åç«¯çš„é«˜çº§ç”¨æˆ·ã€‚åŒ…å« actor/critic æ¨¡å‹ã€ä¼˜åŒ–å™¨å‚æ•°å’Œè®­ç»ƒå¾ªç¯çš„ç»†ç²’åº¦è®¾ç½®ã€‚</p>
<blockquote>
<div><p>æœ‰å…³å®Œæ•´å‚æ•°å«ä¹‰ï¼Œè¯·å‚è€ƒ <a class="reference external" href="https://verl.readthedocs.io/en/latest/examples/config.html">veRL æ–‡æ¡£</a>ã€‚</p>
</div></blockquote>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">actor_rollout_ref</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hybrid_engine</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external_lib</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">override_config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">enable_gradient_checkpointing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">use_remove_padding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">use_fused_kernels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">fused_kernel_options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">impl_backend</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">actor</span><span class="p">:</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fsdp</span><span class="w">  </span><span class="c1"># è¿™æ˜¯ä¸ºäº†å‘åå…¼å®¹</span>
<span class="w">    </span><span class="c1"># ppo_micro_batch_size: 8 # å°†è¢«å¼ƒç”¨ï¼Œä½¿ç”¨ ppo_micro_batch_size_per_gpu</span>
<span class="w">    </span><span class="nt">ppo_micro_batch_size_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">    </span><span class="nt">use_dynamic_bsz</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">ppo_max_token_len_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16384</span><span class="w"> </span><span class="c1"># n * ${data.max_model_len}</span>
<span class="w">    </span><span class="nt">grad_clip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">    </span><span class="nt">ppo_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">shuffle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">ulysses_sequence_parallel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># sp size</span>
<span class="w">    </span><span class="nt">entropy_from_logits_with_chunking</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">entropy_checkpointing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">checkpoint</span><span class="p">:</span>
<span class="w">      </span><span class="nt">load_contents</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;model&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;optimizer&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;extra&#39;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">save_contents</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;model&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;optimizer&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;extra&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">optim</span><span class="p">:</span>
<span class="w">      </span><span class="nt">lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1e-6</span>
<span class="w">      </span><span class="nt">lr_warmup_steps_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.</span><span class="w">  </span><span class="c1"># æ€»æ­¥æ•°å°†åœ¨è¿è¡Œæ—¶æ³¨å…¥</span>
<span class="w">      </span><span class="c1"># min_lr_ratio: null   # ä»…åœ¨ä½™å¼¦é¢„çƒ­æ—¶æœ‰ç”¨</span>
<span class="w">      </span><span class="nt">warmup_style</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">constant</span><span class="w">  </span><span class="c1"># ä» constant/cosine ä¸­é€‰æ‹©</span>
<span class="w">      </span><span class="nt">total_training_steps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w">  </span><span class="c1"># å¿…é¡»ç”±ç¨‹åºè¦†ç›–</span>
<span class="w">    </span><span class="nt">fsdp_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">wrap_policy</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># transformer_layer_cls_to_wrap: None</span>
<span class="w">        </span><span class="nt">min_num_params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">param_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">      </span><span class="nt">optimizer_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">      </span><span class="nt">fsdp_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span>
<span class="w">      </span><span class="nt">forward_prefetch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">ref</span><span class="p">:</span>
<span class="w">    </span><span class="nt">fsdp_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">param_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">      </span><span class="nt">wrap_policy</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># transformer_layer_cls_to_wrap: None</span>
<span class="w">        </span><span class="nt">min_num_params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">fsdp_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span>
<span class="w">      </span><span class="nt">forward_prefetch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="c1"># log_prob_micro_batch_size: 4 # å°†è¢«å¼ƒç”¨ï¼Œä½¿ç”¨ log_prob_micro_batch_size_per_gpu</span>
<span class="w">    </span><span class="nt">log_prob_micro_batch_size_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">    </span><span class="nt">log_prob_use_dynamic_bsz</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${actor_rollout_ref.actor.use_dynamic_bsz}</span>
<span class="w">    </span><span class="nt">log_prob_max_token_len_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${actor_rollout_ref.actor.ppo_max_token_len_per_gpu}</span>
<span class="w">    </span><span class="nt">ulysses_sequence_parallel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${actor_rollout_ref.actor.ulysses_sequence_parallel_size}</span><span class="w"> </span><span class="c1"># sp size</span>
<span class="w">    </span><span class="nt">entropy_from_logits_with_chunking</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${actor_rollout_ref.actor.entropy_from_logits_with_chunking}</span>
<span class="w">    </span><span class="nt">entropy_checkpointing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${actor_rollout_ref.actor.entropy_checkpointing}</span>

<span class="nt">critic</span><span class="p">:</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fsdp</span>
<span class="w">  </span><span class="nt">optim</span><span class="p">:</span>
<span class="w">    </span><span class="nt">lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1e-5</span>
<span class="w">    </span><span class="nt">lr_warmup_steps_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.</span><span class="w">  </span><span class="c1"># æ€»æ­¥æ•°å°†åœ¨è¿è¡Œæ—¶æ³¨å…¥</span>
<span class="w">    </span><span class="c1"># min_lr_ratio: null   # ä»…åœ¨ä½™å¼¦é¢„çƒ­æ—¶æœ‰ç”¨</span>
<span class="w">    </span><span class="nt">warmup_style</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">constant</span><span class="w">  </span><span class="c1"># ä» constant/cosine ä¸­é€‰æ‹©</span>
<span class="w">    </span><span class="nt">total_training_steps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w">  </span><span class="c1"># å¿…é¡»ç”±ç¨‹åºè¦†ç›–</span>
<span class="w">  </span><span class="nt">model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">override_config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">external_lib</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${actor_rollout_ref.model.external_lib}</span>
<span class="w">    </span><span class="nt">enable_gradient_checkpointing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">use_remove_padding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">fsdp_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">param_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">      </span><span class="nt">optimizer_offload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">      </span><span class="nt">wrap_policy</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># transformer_layer_cls_to_wrap: None</span>
<span class="w">        </span><span class="nt">min_num_params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">fsdp_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span>
<span class="w">      </span><span class="nt">forward_prefetch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">ppo_micro_batch_size_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">  </span><span class="nt">forward_micro_batch_size_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${critic.ppo_micro_batch_size_per_gpu}</span>
<span class="w">  </span><span class="nt">use_dynamic_bsz</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${actor_rollout_ref.actor.use_dynamic_bsz}</span>
<span class="w">  </span><span class="nt">ppo_max_token_len_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32768</span><span class="w"> </span><span class="c1"># (${actor_rollout_ref.actor.ppo_max_token_len_per_gpu}) * 2</span>
<span class="w">  </span><span class="nt">forward_max_token_len_per_gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${critic.ppo_max_token_len_per_gpu}</span>
<span class="w">  </span><span class="nt">ulysses_sequence_parallel_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># sp size</span>
<span class="w">  </span><span class="nt">ppo_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${actor_rollout_ref.actor.ppo_epochs}</span>
<span class="w">  </span><span class="nt">shuffle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${actor_rollout_ref.actor.shuffle}</span>
<span class="w">  </span><span class="nt">grad_clip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">  </span><span class="nt">cliprange_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>

<span class="nt">trainer</span><span class="p">:</span>
<span class="w">  </span><span class="nt">balance_batch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="c1"># total_training_steps: null</span>
<span class="w">  </span><span class="nt">resume_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
<span class="w">  </span><span class="nt">resume_from_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">  </span><span class="nt">critic_warmup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">default_hdfs_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">remove_previous_ckpt_in_save</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">del_local_ckpt_after_load</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">  </span><span class="nt">max_actor_ckpt_to_keep</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">max_critic_ckpt_to_keep</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.model.enable_gradient_checkpointing</span></code>: æ˜¯å¦å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹ï¼Œä»¥å‡å°‘ GPU å†…å­˜ä½¿ç”¨ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.model.use_remove_padding</span></code>: æ˜¯å¦ç§»é™¤å¡«å…… tokenï¼Œä»¥å‡å°‘è®­ç»ƒæ—¶é—´ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.model.use_fused_kernels</span></code>: æ˜¯å¦ä½¿ç”¨è‡ªå®šä¹‰èåˆå†…æ ¸ï¼ˆå¦‚ FlashAttentionã€èåˆ MLPï¼‰ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.model.fused_kernel_options.impl_backend</span></code>: èåˆå†…æ ¸çš„å®ç°åç«¯ã€‚è‹¥ <code class="docutils literal notranslate"><span class="pre">use_fused_kernels</span></code> ä¸º trueï¼Œåˆ™ä½¿ç”¨æ­¤é€‰é¡¹ã€‚å¯é€‰å€¼ï¼š&quot;triton&quot; æˆ– &quot;torch&quot;ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.use_dynamic_bsz</span></code>: æ˜¯å¦é‡æ–°ç»„ç»‡æ‰¹æ•°æ®ï¼Œå…·ä½“æ˜¯æ‹¼æ¥è¾ƒçŸ­æ•°æ®ä»¥å‡å°‘å®é™…è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ‰¹å¤§å°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.ppo_micro_batch_size_per_gpu</span></code>: å•ä¸ª GPU ä¸€æ¬¡å‰å‘ä¼ æ’­çš„æ‰¹å¤§å°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.ulysses_sequence_parallel_size</span></code>: Ulysses åºåˆ—å¹¶è¡Œå¤§å°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.entropy_from_logits_with_chunking</span></code>: ä½¿ç”¨åˆ†å—è®¡ç®—ç†µä»¥é™ä½å†…å­˜å³°å€¼ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.entropy_checkpointing</span></code>: é‡æ–°è®¡ç®—ç†µã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.checkpoint</span></code>: è¦åŠ è½½å’Œä¿å­˜çš„å†…å®¹ã€‚ä½¿ç”¨ 'hf_model' å¯å°†æ•´ä¸ªæ¨¡å‹ä¿å­˜ä¸º hf æ ¼å¼ï¼›ç›®å‰ä»…ä½¿ç”¨åˆ†ç‰‡æ£€æŸ¥ç‚¹ä»¥èŠ‚çœç©ºé—´ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.optim.lr</span></code>: actor æ¨¡å‹çš„å­¦ä¹ ç‡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.optim.lr_warmup_steps_ratio</span></code>: å­¦ä¹ ç‡é¢„çƒ­æ­¥æ•°æ¯”ä¾‹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.optim.warmup_style</span></code>: å­¦ä¹ ç‡é¢„çƒ­æ–¹å¼ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.actor.optim.total_training_steps</span></code>: actor æ¨¡å‹çš„æ€»è®­ç»ƒæ­¥æ•°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actor_rollout_ref.ref.log_prob_micro_batch_size_per_gpu</span></code>: å•ä¸ª GPU åœ¨ä¸€æ¬¡å‚è€ƒæ¨¡å‹å‰å‘ä¼ æ’­ä¸­çš„æ‰¹å¤§å°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic.model.enable_gradient_checkpointing</span></code>: æ˜¯å¦å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹ï¼Œä»¥å‡å°‘ GPU å†…å­˜ä½¿ç”¨ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic.model.use_remove_padding</span></code>: æ˜¯å¦ç§»é™¤å¡«å…… tokenï¼Œä»¥å‡å°‘è®­ç»ƒæ—¶é—´ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic.optim.lr</span></code>: critic æ¨¡å‹çš„å­¦ä¹ ç‡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic.optim.lr_warmup_steps_ratio</span></code>: å­¦ä¹ ç‡é¢„çƒ­æ­¥æ•°æ¯”ä¾‹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic.optim.warmup_style</span></code>: å­¦ä¹ ç‡é¢„çƒ­é£æ ¼ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic.optim.total_training_steps</span></code>: critic æ¨¡å‹çš„æ€»è®­ç»ƒæ­¥æ•°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic.ppo_micro_batch_size_per_gpu</span></code>: å•ä¸ª GPU åœ¨ä¸€æ¬¡ critic æ¨¡å‹å‰å‘ä¼ æ’­ä¸­çš„æ‰¹å¤§å°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic.ulysses_sequence_parallel_size</span></code>: Ulysses åºåˆ—å¹¶è¡Œå¤§å°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic.grad_clip</span></code>: critic æ¨¡å‹è®­ç»ƒçš„æ¢¯åº¦è£å‰ªã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critic.cliprange_value</span></code>: ç”¨äºè®¡ç®—å€¼æŸå¤±ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer.balance_batch</span></code>: è®­ç»ƒæœŸé—´æ˜¯å¦åœ¨ GPU é—´å¹³è¡¡æ‰¹å¤§å°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer.resume_mode</span></code>: è®­ç»ƒçš„æ¢å¤æ¨¡å¼ã€‚æ”¯æŒ <code class="docutils literal notranslate"><span class="pre">disable</span></code>ã€<code class="docutils literal notranslate"><span class="pre">auto</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">resume_path</span></code>ã€‚é»˜è®¤æ˜¯<code class="docutils literal notranslate"><span class="pre">auto</span></code>ï¼Œå³æŸ¥æ‰¾æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹ä»¥æ¢å¤ï¼›è‹¥æ‰¾ä¸åˆ°ï¼Œåˆ™ä»å¤´å¼€å§‹è®­ç»ƒã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer.resume_from_path</span></code>: æ¢å¤è·¯å¾„ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer.critic_warmup</span></code>: åœ¨å®é™…ç­–ç•¥å­¦ä¹ å‰è®­ç»ƒ critic æ¨¡å‹çš„æ­¥æ•°ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer.default_hdfs_dir</span></code>: ä¿å­˜æ£€æŸ¥ç‚¹çš„é»˜è®¤ HDFS ç›®å½•ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer.remove_previous_ckpt_in_save</span></code>: ä¿å­˜æ—¶æ˜¯å¦åˆ é™¤ä¹‹å‰çš„æ£€æŸ¥ç‚¹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer.del_local_ckpt_after_load</span></code>: åŠ è½½åæ˜¯å¦åˆ é™¤æœ¬åœ°æ£€æŸ¥ç‚¹ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer.max_actor_ckpt_to_keep</span></code>: æœ€å¤šä¿ç•™çš„ actor æ£€æŸ¥ç‚¹æ•°é‡ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainer.max_critic_ckpt_to_keep</span></code>: æœ€å¤šä¿ç•™çš„ critic æ£€æŸ¥ç‚¹æ•°é‡ã€‚</p></li>
</ul>
</section>
<section id="id8">
<h2>å›¾å½¢åŒ–é…ç½®ç”Ÿæˆå™¨ï¼ˆé«˜çº§ï¼‰<a class="headerlink" href="#id8" title="Link to this heading">#</a></h2>
<p>æœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•ä¸ºé…ç½®ç”Ÿæˆå™¨é¡µé¢æ·»åŠ æ–°çš„é…ç½®å‚æ•°ã€‚</p>
<section id="streamlit">
<h3>æ­¥éª¤ 0ï¼šäº†è§£ Streamlit<a class="headerlink" href="#streamlit" title="Link to this heading">#</a></h3>
<p>åœ¨ä¸ºé…ç½®ç”Ÿæˆå™¨é¡µé¢æ·»åŠ æ–°å‚æ•°ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ <a class="reference external" href="https://docs.streamlit.io/develop/api-reference">Streamlit</a> çš„ç›¸å…³ API å’Œæœºåˆ¶ã€‚æœ¬é¡¹ç›®ä¸»è¦ä½¿ç”¨ Streamlit çš„å„ç§è¾“å…¥ç»„ä»¶ï¼Œå¹¶åˆ©ç”¨ <code class="docutils literal notranslate"><span class="pre">st.session_state</span></code> å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å‚æ•°ã€‚</p>
</section>
<section id="id9">
<h3>æ­¥éª¤ 1ï¼šå®ç°æ–°é…ç½®é¡¹<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>ä¸ºäº†è¯´æ˜å¦‚ä½•ä¸ºé…ç½®ç”Ÿæˆå™¨é¡µé¢åˆ›å»ºæ–°å‚æ•°è®¾ç½®ï¼Œæˆ‘ä»¬ä»¥ <code class="docutils literal notranslate"><span class="pre">train_batch_size</span></code> ä¸ºä¾‹ã€‚</p>
<ol class="arabic">
<li><p>ç¡®å®šå‚æ•°çš„åˆé€‚ä½œç”¨åŸŸã€‚ç›®å‰å‚æ•°åˆ†ä¸ºå››ä¸ªæ–‡ä»¶ï¼š</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">trinity/manager/config_registry/buffer_config_manager.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trinity/manager/config_registry/explorer_config_manager.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trinity/manager/config_registry/model_config_manager.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trinity/manager/config_registry/trainer_config_manager.py</span></code></p></li>
</ul>
<p>æœ¬ä¾‹ä¸­ï¼Œ<code class="docutils literal notranslate"><span class="pre">train_batch_size</span></code> åº”æ”¾åœ¨ <code class="docutils literal notranslate"><span class="pre">buffer_config_manager.py</span></code> æ–‡ä»¶ä¸­ã€‚</p>
</li>
<li><p>ä½¿ç”¨ Streamlit åˆ›å»ºå‚æ•°è®¾ç½®å‡½æ•°ã€‚å‡½æ•°åå¿…é¡»ä»¥ 'set_' å¼€å¤´ï¼Œå…¶ä½™éƒ¨åˆ†æˆä¸ºé…ç½®åç§°ã€‚</p></li>
<li><p>ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">CONFIG_GENERATORS.register_config</span></code> è£…é¥°å™¨è£…é¥°å‚æ•°è®¾ç½®å‡½æ•°ã€‚è¯¥è£…é¥°å™¨éœ€è¦ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul class="simple">
<li><p>å‚æ•°çš„é»˜è®¤å€¼</p></li>
<li><p>å¯è§æ€§æ¡ä»¶ï¼ˆå¦‚é€‚ç”¨ï¼‰</p></li>
<li><p>é¢å¤–é…ç½®å‚æ•°ï¼ˆå¦‚éœ€è¦ï¼‰</p></li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p><code class="docutils literal notranslate"><span class="pre">CONFIG_GENERATORS.register_config</span></code> è£…é¥°å™¨ä¼šè‡ªåŠ¨å°† <code class="docutils literal notranslate"><span class="pre">key=config_name</span></code> ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ³¨å†Œçš„é…ç½®å‡½æ•°ã€‚ç¡®ä¿ä½ çš„å‡½æ•°æ¥å—æ­¤å…³é”®å­—å‚æ•°ã€‚</p>
</div>
<p>å¯¹äº <code class="docutils literal notranslate"><span class="pre">train_batch_size</span></code>ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹è®¾ç½®ï¼š</p>
<ul class="simple">
<li><p>é»˜è®¤å€¼ï¼š96</p></li>
<li><p>å¯è§æ€§æ¡ä»¶ï¼š<code class="docutils literal notranslate"><span class="pre">lambda:</span> <span class="pre">st.session_state[&quot;trainer_gpu_num&quot;]</span> <span class="pre">&gt;</span> <span class="pre">0</span></code></p></li>
<li><p>é¢å¤–é…ç½®ï¼š<code class="docutils literal notranslate"><span class="pre">{&quot;_train_batch_size_per_gpu&quot;:</span> <span class="pre">16}</span></code></p></li>
</ul>
<p>ä»¥ä¸‹æ˜¯ <code class="docutils literal notranslate"><span class="pre">train_batch_size</span></code> å‚æ•°çš„å®Œæ•´ä»£ç ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@CONFIG_GENERATORS</span><span class="o">.</span><span class="n">register_config</span><span class="p">(</span>
    <span class="n">default_value</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span>
    <span class="n">visible</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;trainer_gpu_num&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">other_configs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;_train_batch_size_per_gpu&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">},</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set_train_batch_size</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
    <span class="n">trainer_gpu_num</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;trainer_gpu_num&quot;</span><span class="p">]</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;_train_batch_size_per_gpu&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;trainer_gpu_num&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_change</span><span class="p">():</span>
        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;_train_batch_size_per_gpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">//</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;trainer_gpu_num&quot;</span><span class="p">],</span> <span class="mi">1</span>
        <span class="p">)</span>

    <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span>
        <span class="s2">&quot;Train Batch Size&quot;</span><span class="p">,</span>
        <span class="n">min_value</span><span class="o">=</span><span class="n">trainer_gpu_num</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="n">trainer_gpu_num</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">_str_for_train_batch_size</span><span class="p">(),</span>
        <span class="n">on_change</span><span class="o">=</span><span class="n">on_change</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>å¦‚æœå‚æ•°éœ€è¦éªŒè¯ï¼Œåˆ›å»ºä¸€ä¸ªæ£€æŸ¥å‡½æ•°ã€‚å¯¹äº <code class="docutils literal notranslate"><span class="pre">train_batch_size</span></code>ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å®ƒèƒ½è¢« <code class="docutils literal notranslate"><span class="pre">trainer_gpu_num</span></code> æ•´é™¤ã€‚è‹¥ä¸èƒ½ï¼Œåˆ™æ˜¾ç¤ºè­¦å‘Šï¼Œå¹¶å°†å‚æ•°æ·»åŠ åˆ° <code class="docutils literal notranslate"><span class="pre">unfinished_fields</span></code>ã€‚</p>
<p>ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">CONFIG_GENERATORS.register_check</span></code> è£…é¥°å™¨è£…é¥°æ£€æŸ¥å‡½æ•°ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@CONFIG_GENERATORS</span><span class="o">.</span><span class="n">register_check</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_train_batch_size</span><span class="p">(</span><span class="n">unfinished_fields</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">%</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;trainer_gpu_num&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">unfinished_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">_str_for_train_batch_size</span><span class="p">())</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p><code class="docutils literal notranslate"><span class="pre">CONFIG_GENERATORS.register_check</span></code> è£…é¥°å™¨ä¼šè‡ªåŠ¨æ¥æ”¶ <code class="docutils literal notranslate"><span class="pre">key=config_name</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">unfinished_fields=self.unfinished_fields</span></code> ä½œä¸ºå‚æ•°ã€‚ç¡®ä¿ä½ çš„å‡½æ•°æ¥å—è¿™äº›å…³é”®å­—å‚æ•°ã€‚</p>
</div>
</section>
<section id="config-manager-py">
<h3>æ­¥éª¤ 2ï¼šå°†æ–°å‚æ•°é›†æˆåˆ° <code class="docutils literal notranslate"><span class="pre">config_manager.py</span></code><a class="headerlink" href="#config-manager-py" title="Link to this heading">#</a></h3>
<p>è¦æˆåŠŸå°†æ–°å‚æ•°é›†æˆåˆ° <code class="docutils literal notranslate"><span class="pre">config_manager.py</span></code> æ–‡ä»¶ä¸­ï¼Œè¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol class="arabic">
<li><p><strong>å‚æ•°åˆ†ç±»</strong>ï¼š
æ ¹æ®å…¶åŠŸèƒ½ç¡®å®šæ–°å‚æ•°çš„åˆé€‚éƒ¨åˆ†ã€‚é…ç½®ç”Ÿæˆå™¨é¡µé¢åˆ†ä¸ºä¸¤ç§ä¸»è¦æ¨¡å¼ï¼š</p>
<ul class="simple">
<li><p>åˆå­¦è€…æ¨¡å¼ï¼šåŒ…å«â€œåŸºæœ¬é…ç½®â€å’Œâ€œé‡è¦é…ç½®â€éƒ¨åˆ†ã€‚</p></li>
<li><p>ä¸“å®¶æ¨¡å¼ï¼šåŒ…å«â€œæ¨¡å‹â€ã€â€œç¼“å†²åŒºâ€ã€â€œExplorer å’Œ Synchronizerâ€ä»¥åŠâ€œTrainerâ€éƒ¨åˆ†ã€‚</p></li>
</ul>
</li>
<li><p><strong>æ·»åŠ å‚æ•°</strong>ï¼š
åœ¨ <code class="docutils literal notranslate"><span class="pre">ConfigManager</span></code> ç±»çš„ <code class="docutils literal notranslate"><span class="pre">self.get_configs</span></code> æ–¹æ³•ä¸­ï¼Œå°†æ–°å‚æ•°æ·»åŠ åˆ°ç›¸åº”éƒ¨åˆ†ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ConfigManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_expert_buffer_part</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_configs</span><span class="p">(</span><span class="s2">&quot;total_epochs&quot;</span><span class="p">,</span> <span class="s2">&quot;train_batch_size&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>é›†æˆåˆ° YAML æ–‡ä»¶</strong>ï¼š
åœ¨ YAML æ–‡ä»¶ç»“æ„ä¸­æ‰¾åˆ°æ–°å‚æ•°çš„åˆé€‚ä½ç½®ã€‚åº”åœ¨ <code class="docutils literal notranslate"><span class="pre">generate_config</span></code> å‡½æ•°åŠå…¶å…³è”å­å‡½æ•°ä¸­å®Œæˆã€‚</p></li>
<li><p><strong>èµ‹å€¼å‚æ•°å€¼</strong>ï¼š
ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">st.session_state</span></code> ä»é…ç½®ç”Ÿæˆå™¨é¡µé¢è·å–å‚æ•°å€¼ï¼Œå¹¶å°†å…¶èµ‹ç»™ YAML ä¸­çš„å¯¹åº”å­—æ®µã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ConfigManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_gen_buffer_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">buffer_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;train_batch_size&quot;</span><span class="p">],</span>
            <span class="c1"># Additional configuration parameters</span>
        <span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
<p>ä¸¥æ ¼éµå¾ªè¿™äº›æ­¥éª¤ï¼Œä½ å¯ä»¥ç¡®ä¿æ–°å‚æ•°æˆåŠŸæ·»åŠ åˆ°é…ç½®ç”Ÿæˆå™¨é¡µé¢ï¼Œå¹¶æ­£ç¡®é›†æˆåˆ°é…ç½®ç³»ç»Ÿä¸­ã€‚</p>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="develop_selector.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">ä¸Šä¸€é¡µ</p>
        <p class="prev-next-title">ğŸ§ª å®éªŒæ€§åŠŸèƒ½ï¼šä»»åŠ¡é€‰æ‹©å™¨</p>
      </div>
    </a>
    <a class="right-next"
       href="trinity_gpu_configs.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">ä¸‹ä¸€é¡µ</p>
        <p class="prev-next-title">GPU èµ„æºç›¸å…³é…ç½®æŒ‡å—</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> ç›®å½•
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">æ¦‚è¿°</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">å…¨å±€é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">ç®—æ³•é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">ç›‘æ§é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model">Model é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cluster">Cluster é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#buffer">Buffer é…ç½®</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explorer">Explorer è¾“å…¥é…ç½®</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trainer">Trainer è¾“å…¥é…ç½®</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Explorer é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronizer">Synchronizer é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Trainer é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#service">Service é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataprocessor">DataProcessor é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#log">Log é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stage">Stage é…ç½®</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verl-trainer">veRL Trainer é…ç½®ï¼ˆé«˜çº§ï¼‰</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">å›¾å½¢åŒ–é…ç½®ç”Ÿæˆå™¨ï¼ˆé«˜çº§ï¼‰</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#streamlit">æ­¥éª¤ 0ï¼šäº†è§£ Streamlit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">æ­¥éª¤ 1ï¼šå®ç°æ–°é…ç½®é¡¹</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#config-manager-py">æ­¥éª¤ 2ï¼šå°†æ–°å‚æ•°é›†æˆåˆ° <code class="docutils literal notranslate"><span class="pre">config_manager.py</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
ä½œè€…ï¼š Trinity-RFT Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2025, Trinity-RFT Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>